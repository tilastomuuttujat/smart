<!DOCTYPE html>
<html lang="fi">
<meta charset="UTF-8">

<head>
	<script src="https://www.gstatic.com/charts/loader.js"></script>
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
	<style>
        .Menneisyys { fill: #CE2A23; }
        .Nykyisyys { fill: #555; }
        .Tulevaisuus { fill: #aaa; }
        .Ajanhallinta { fill: #ccc; }
        .Lähtökohdat { fill: #CE2A23; }
        .Olosuhteet { fill: #555; }
        .Voimavarat { fill: #aaa; }
        .Ympäristö { fill: #ccc; }
 

        .legend {
        width: 200px;
            /*position: absolute;*/
            left: 150px;
            top: 30px;
            font-size: 14px;
        }

        .legend_item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            color: gray;
        }

        .legend_item_icon {
            width: 14px;
            height: 14px;
            margin-right: 5px;
            /*border-radius: 50%; *//* Muuta neliö ympyräksi */
        } 	
ul li {
list-style-type: none;
font-size: 8pt;
/*color: #909090;*/
}

#suns {
    margin: 3rem 0;
}

#suns1 {
    margin: 3rem 0;
}

svg.countrySun {
    margin-right: 20px;
}

.countrySun text.countryName {
    font-size: 14px;
    fill: #909090;
}

.sun.center {
    stroke-width: 2px;
    fill: #dfdfdf;
}

.ray {
    stroke-width: 2px;
}

.sun.gridline {
    stroke: #dfdfdf;
    fill: none;
    stroke-width: 2px;
}

.sunLegend {
    margin-top: 40px;
}

.sunLegend .legend_explanation {
    display: inline-block;
    height: 300px;
    columns: 2;
    margin-left: 30px;
}

.sunLegend .legend_explanation ol {
    margin: 0;
}

.sunLegend li {
    font-size: 14px;
}

.sunLegend p {
    font-size: 14px;
    margin: 0;
    padding-left: 260px;
}

.sunLegend p:first-of-type {
    margin-top: 20px;
}

#sun_legend {
    margin-top: 0px;
    margin-left: 10px;
}

#sun_legend .legendText {
    fill: #909090;
    font-size: 14px;
    text-anchor: middle;
    dominant-baseline: middle;
}

#sun_legend1 {
    margin-top: 0px;
    margin-left: 10px;
}

#sun_legend1 .legendText {
    fill: #909090;
    font-size: 14px;
    text-anchor: middle;
    dominant-baseline: middle;
}	
::selection{/*background-color:#e2e2e2*/}
#root{max-width:48rem;padding:1rem 1.5rem;/*color:#232323*/;height:700px;overflow-y:scroll}

h1{font-size:1.48rem}
p{line-height:1.5}
svg{margin:1rem auto;color:#444;--color-line:hsl(0, 0%, 89%)}


html{box-sizing:border-box}
*,:after,:before{box-sizing:inherit}
body{font-family:Avenir;padding:0;margin:0;background-color: transparent;}

.left-content{height:88vh;background-color: rgba(255,255,255,0.5);position:relative;box-shadow:5px 0 10px 0 rgba(50,50,50,.2);position:absolute;top:200px}
.left-inner{position:sticky;height:86vh;overflow-y:scroll}
.form-header{display:flex;align-items:center;width:460px;padding:30px;box-shadow:5px 0 12px rgba(0,0,0,.12)}
.form-header .logo{width:32px;height:32px;background:#dd0f65;margin-right:20px}
.form-header h1{font-size:24px;margin:0;font-weight:300;white-space:nowrap}
.form-wrap{width:460px;padding:30px 20px}
.form-section{margin-bottom:40px}
.form-section h2{font-size:24px;margin:0 0 30px}
.form-row{display:flex;margin-bottom:20px}
.form-field{width:100%}
.form-field label{display:inline-block;font-size:14px;font-weight:500;color:#000;margin-bottom:6px}

.divider{border-top:1px solid #868686;border-bottom:1px solid #868686;margin-bottom:30px}
.slide-in{background:#fff;width:0;z-index:1;transition:.5s;flex-grow:0;flex-shrink:0}
.slide-in.open{width:460px}
.toggle-btn{position:absolute;display:flex;align-items:center;z-index:9999;height:28px;top:40px;padding:0 20px;right:-61px;color:#fff;background-color:#00787a;transform:rotate(90deg);border-radius:6px 6px 0 0;box-shadow:5px 0 10px 0 rgba(50,50,50,.2)}
.toggle-btn:hover{cursor:pointer}
#overlay{position:absolute;/*background-color:#f07ab7*/;display:none;z-index:5000}
#toggle-overlay-button{padding:10px 20px;background-color:#337ab7;color:#fff;border:none;border-radius:5px;cursor:pointer;z-index:9999}
.form-dropdown{border-color:#575757;color:#202020;background-color:rgba(248,248,248,0);align:right}
table label{font-size:8px;color:#a9a9a9}
td{height:10px}
tr{line-height:12px}
.barsNumbers{font-family:"PT Sans",sans-serif;font-size:12px;fill:#777}
.textDescription{font-family:"PT Sans",sans-serif;font-size:14px;fill:#444;cursor:default}
.textDescriptionRisk{font-family:"PT Sans",sans-serif;font-size:14px;fill:#666;cursor:default}
.textDescription3{font-family:"PT Sans",sans-serif;font-size:14px;fill:#666;cursor:default}
.textDescription2{font-family:"PT Sans",sans-serif;font-size:11px;fill:#999;cursor:default}
.legendTitle{font-family:Roboto,sans-serif;font-size:18px;fill:#444;cursor:default}
.nodesLabelBack{font-family:"PT Sans",sans-serif;fill:#fff;font-size:10px;pointer-events:none;stroke:#fff;stroke-width:3px;cursor:default}
.nodesLabel{font-family:"PT Sans",sans-serif;fill:#444;font-size:10px;pointer-events:none;cursor:default}
.noCategory{fill:#2f4f4f;font-size:20px;font-family:Roboto}
.link{fill:none;stroke:#ccc}
.barAxis line,.barAxis path{stroke:#999}
.barAxis text{font:10px sans-serif;fill:#999}
.sana{writing-mode:vertical-lr;transform:rotate(180deg);font-size:50px;color:gray}
.slide{display:flex;align-items:center}
.slider{width:530px;text-align:center;overflow:hidden;display:flex}
.slides{display:flex;align-items:center;overflow-x:auto;-ms-scroll-snap-type:x mandatory;scroll-snap-type:x mandatory;scroll-behavior:smooth;-webkit-overflow-scrolling:touch}
.slides::-webkit-scrollbar-thumb{background:#000;border-radius:10px}
.slides::-webkit-scrollbar-track{background:0 0}
.slides>div{scroll-snap-align:start;flex-shrink:0;width:530px;height:290px}
#canvas{position:relative;background-image:url(elonkeha_tausta.svg);background-size:cover;width:900px;height:900px;border:0 solid #ccc}
.circle-group{position:absolute;cursor:move}
.circle{position:relative;display:inline-block;width:22px;height:22px;border-radius:50%}
.text-field{position:absolute;top:0;left:11px;width:160px;height:22px;text-align:center}
.info-field{position:absolute;top:0;left:20px;width:400px;height:450px;text-align:center}
body{height:100%;/*background-color:#ebebeb;color:#f5f5f5*/;font-size:16px;font-family:Lato}
h1{font-size:32px}
h2{font-size:26px}h3{font-size:18px}
p{margin:0 0 15px;line-height:24px;color:#dcdcdc}
a{color:#1e90ff;text-decoration:none;border-bottom:1px dotted}
a:hover{color:tomato}
.container{max-width:960px;height:960px;margin:0 auto;padding:20px}
.tabs{position:relative;display:flex;min-height:960px;border-radius:8px 8px 0 0;overflow:hidden}
.tabby-tab{flex:1}
.tabby-tab label{display:block;box-sizing:border-box;height:40px;padding:10px;text-align:center;/*background:#8d8d8d*/;cursor:pointer;transition:background .5s ease}
.tabby-tab label:hover{background: #e7cf0d}
.tabby-content{position:absolute;left:0;bottom:0;right:0;top:40px;padding:20px;border-radius:0 0 8px 8px;/*background:#ebebeb*/;transition:opacity .8s ease,transform .8s ease;opacity:0;transform:scale(.1);transform-origin:top left}
.tabby-content img{float:left;margin-right:20px;border-radius:8px}
.tabby-tab [type=radio]{display:none}
[type=radio]:checked~label{background: #af9d0c;z-index:2}
[type=radio]:checked~label~.tabby-content{z-index:1;opacity:1;transform:scale(1)}
@media screen and (max-width:767px){.tabs{min-height:400px}}
@media screen and (max-width:480px){.tabs{min-height:580px}
.tabby-tab label{height:60px}
.tabby-content{top:60px}
.tabby-content img{float:none;margin-right:0;margin-bottom:20px}}
h1{text-align:left;font-weight:100;font-size:40px;color:#e74c3c}
#videoContainer {
	position: fixed;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	background-color: white;
	z-index: 9999;
	display: none;
}

#myVideo,
#floatingVideo,
.thumbs {
	width: 100%;
	max-width: 566px;
	height: auto;
	outline: none;
}

.thumb {
	width: 10%;
	display: inline-block;
	border: 1px solid #919191;
	text-transform: uppercase;
	line-height: 20px;
	background-size: 100% auto;
	cursor: pointer;
	font-size: 50%;
	text-align: center;
	color: gray;
}

.close-button {
	position: absolute;
	top: 10px;
	right: 10px;
	font-size: 16px;
	cursor: pointer;
}

	</style>
</head>

<body>

	<div class="container">
		<h1>Itsearviointi</h1>

		<button id="toggle-overlay-button" onClick="toggleOverlay();">?</button>
			
			<div class="thumb" onclick="playVid('one')">Ohjevideo 1</div>
			<div class="thumb" onclick="playVid('two')">Ohjevideo 2</div>
			<div class="thumb" onclick="playVid('three')">Ohjevideo 3</div>
			<div class="thumb" onclick="playVid('four')">Ohjevideo 4</div>
			<div class="thumb" onclick="playVid('five')">Ohjevideo 5</div>
<div id="videoContainer">
	<video id="floatingVideo" controls autoplay>
		<source src="" type="video/mp4">
	</video>
	<span class="close-button" onclick="closeFloatingVideo()">&#x2715;</span>
</div>
		<div id="overlay"></div>
		<div class="tabs">	
			<div class="tabby-tab">
				<input type="radio" id="tab-1" onclick="kasitteet()" name="tabby-tabs" checked>
				<label for="tab-1">Valitse käsitteet</label>
				<div class="tabby-content">
					
					<div id="wheel" style="color: black;"></div>
					<div id="textContainer"></div>

				</div>
			</div>
			<div class="tabby-tab">
				<input type="radio" id="tab-2" onclick="ohjeruutu='30';saveCircles()" name="tabby-tabs">
				<label for="tab-2">Valitut käsitteet</label>
				<div class="tabby-content">

					<div id="canvas"></div>
				</div>
			</div>
			<div class="tabby-tab">
				<input type="radio" id="tab-3" onclick="AnalyzeReds()" name="tabby-tabs">
				<label for="tab-3">Käsitteiden väliset sidokset</label>
				<div class="tabby-content">
					<div id="svganchor" style="width: 100%;height: 100%;/*background-color: #ebebeb*/;"></div>
				</div>
			</div>
			<div class="tabby-tab">
				<input type="radio" id="tab-4" onclick="vertailu(yhteen)" name="tabby-tabs">
				<label for="tab-4">Vertailu</label>
				<div class="tabby-content">
				<button id="toggle-overlay-button1" style="color:white" onClick="toggleOverlay1();">Vahvuudet</button>
					<table>
<tr>
<td>
<table style="color:gray;font-size:10px" height="50">
<td width="150">Menneisyys</td><td style="text-align:right" width="150">Nykyisyys</td>
</table>
  <svg id="sun_legend"></svg>
<table style="color:gray;font-size:10px">
<td width="150">Ajanhallinta</td><td style="text-align:right" width="150">Tulevaisuus</td>
</table>
</td>
<td>
<table style="color:gray;font-size:14px">
<td width="150">ELÄMÄNKULKU</td>
</table>
  <div id="legend_list"></div>
</td> 
<td width="150">
</td>
<td>
<table style="color:gray;font-size:10px" height="50">
<td width="150">Lähtökohdat</td><td style="text-align:right" width="150">Olosuhteet</td>
</table>
  <svg id="sun_legend1"></svg>
<table style="color:gray;font-size:10px" height="50">
<td width="150">Ympäristö</td><td style="text-align:right" width="150">Voimavarat</td>
</table>
</td>
<td>
<table style="color:gray;font-size:14px">
<td width="150">ELÄMÄNLAATU</td>
</table>
  <div id="legend_list1"></div>
</td> 
</tr>
</table>


<table>
<td>
<div id="chart" class="chart"></div>
</td>
<td>
<div id="legend" class="legend"></div>
</td>
<td>
<div id="chart1" class="chart"></div>
</td>
<td>
<div id="legend1" class="legend1"></div>
</td>
</table>



					</div>
				</div>
			</div>
		</div>
		<div class="wrap">
			<div class="left-content slide-in open" id="sideForm">
				<div class="left-inner">
					<div class="form-header">
						<div class="logo"></div>
						<h1>Tietojen poiminta ja tallennus</h1>
					</div>
					<div class="form-wrap">
						<form id="hae">
							<div class="form-section">
								<div class="form-row">
									<div class="form-field">
										<label>Tunnus</label>
										<input type="text" id="name" placeholder="Anna tunnus" required/>
									</div>
									<div class="form-field">
										<label>Varmenne</label>
										<input type="text" id="pin" placeholder="Anna varmenne" required/>
									</div>
									<button type="submit">Hae</button>
								</div>
						</form>
					</div>
					<div id="kuittaus1" style="color: black"></div>
					<div class="divider"></div>
					<h1>Taustatiedot</h1>
					<table>
						<td>	
							<form id="dataForm">
								<table>
									<tr>
										<td>
											<label for="gender">Sukupuoli:</label><br>
											<select class="form-dropdown" id="gender" name="gender" required>
												<option value="">Valitse sukupuoli</option>
												<option selected="selected" value="mies">Mies</option>
												<option value="nainen">Nainen</option>
												<option value="muu">Muu</option>
											</select><br>
										</td>
										<td>
											<label for="age">Ikäryhmä:</label><br>
											<select class="form-dropdown" id="age" name="age" required>
												<option value="">Valitse ikäryhmä</option>
												<option value="18-24">18-24</option>
												<option value="25-34">25-34</option>
												<option value="35-44">35-44</option>
												<option value="45-54">45-54</option>
												<option selected="selected" value="55-64">55-64</option>
												<option value="65+">65+</option>
											</select><br>
										</td>
										<td>
											<label for="activity">Sosioekonominen asema:</label><br>
											<select class="form-dropdown" id="activity" name="activity" required>
												<option value="">Valitse ryhmä</option>
												<option value="johtava">Johtava asema</option>
												<option value="asiantuntija">Asiantuntija</option>
												<option value="esihenkilo">Esihenkilö</option>
												<option value="tyontekija">Työntekijä</option>
												<option value="yrittaja">Yrittäjä</option>
												<option value="opiskelija">Opiskelija</option>
												<option value="elakelainen">Eläkeläinen</option>
												<option value="alle2vtyoton">Työtön alle 2 vuotta</option>
												<option selected="selected" value="yli2vtyoton">Työtön yli 2 vuotta</option>
												<option value="muu">Muu</option>
											</select><br>
										</td>
									</tr>
									<tr>
										<td>
											<label for="education">Koulutusaste:</label><br>
											<select class="form-dropdown" id="education" name="education" required>
												<option value="">Valitse koulutusaste</option>
												<option selected="selected" value="perus">Perusaste</option>
												<option value="keski">Keskiaste</option>
												<option value="korkea">Korkea-aste</option>
											</select><br>
										</td>
										<td>
											<label for="family">Perhetyyppi:</label><br>
											<select class="form-dropdown" id="family" name="family" required>
												<option value="">Valitse perhetyyppi</option>
												<option value="lapsiperhe">Lapsiperhe</option>
												<option value="parisuhde">Parisuhde</option>
												<option value="yksinhuoltaja">Yksinhuoltaja</option>
												<option selected="selected" value="naimaton">Yksinasuva</option>
												<option value="muu">Muu</option>
											</select><br>
										</td>
										<td>
											<label for="income">Kuukausitulot:</label><br>
											<select class="form-dropdown" id="income" name="income" required>
												<option value="">Valitse tuloryhmä</option>
												<option selected="selected" value="alle 1500">alle 1500€</option>
												<option value="1500-2999">1500-2999€</option>
												<option value="3000-4499">3000-4499€</option>
												<option value="4500-5999">4500-5999€</option>
												<option value="yli 6000">yli 6000€</option>
											</select><br>
										</td>
									</tr>
								</table>
								<table>
									<tr>
										<td>
											<label for="location">Hyvinvointialue:</label><br>
											<select class="form-dropdown" id="location" name="location" value="99" required>
												<option value="">Valitse hyvinvointialue</option>
												<option selected="selected" value="90">Helsinki</option>
												<option value="01">Itä-Uusimaa</option>
												<option value="02">Keski-Uusimaa</option>
												<option value="03">Länsi-Uusimaa</option>
												<option value="04">Vantaa ja Kerava</option>
												<option value="05">Varsinais-Suomi</option>
												<option value="06">Satakunta</option>
												<option value="07">Kanta-Häme</option>
												<option value="08">Pirkanmaa</option>
												<option value="09">Päijät-Häme</option>
												<option value="10">Kymenlaakso</option>
												<option value="11">Etelä-Karjala</option>
												<option value="12">Etelä-Savo</option>
												<option value="13">Pohjois-Savo</option>
												<option value="14">Pohjois-Karjala</option>
												<option value="15">Keski-Suomi</option>
												<option value="16">Etelä-Pohjanmaa</option>
												<option value="17">Pohjanmaa</option>
												<option value="18">Keski-Pohjanmaa</option>
												<option value="19">Pohjois-Pohjanmaa</option>
												<option value="20">Kainuu</option>
												<option value="21">Lappi</option>
												<option value="91">Ahvenanmaa</option>
											</select><br><br>
										</td>
										<td>
									<tr>
										<td>
											<textarea id="message" rows="20" cols="50" style="overflow-y: scroll;"></textarea><br>
											<button type="submit">Lähetä</button>
										</td>
									</tr>
								</table>
							</form>
						</td>
						</tr>
					</table>
					<br>
					<div id="kuittaus" style="color: black"></div>

				</div>
			</div>
			<div id="toggle-btn" class="toggle-btn"><span onclick="toggleOpen()">Lomake</span></div>
		</div>
		<div class="right-content" id="main">
		</div>
	</div>
	</div>
	<script>
var floatingVideo = document.getElementById("floatingVideo"),
	videoContainer = document.getElementById("videoContainer");

function playVid(ID) {
	var mp4Url = "";

	switch (ID) {
		case "one":
			mp4Url = "https://tilastomuuttujat.github.io/kuntatilastomuuttujat/wordclouds/osa1.mp4";
			break;
		case "two":
			mp4Url = "https://tilastomuuttujat.github.io/kuntatilastomuuttujat/wordclouds/osa2.mp4";
			break;
		case "three":
			mp4Url = "https://tilastomuuttujat.github.io/kuntatilastomuuttujat/wordclouds/osa3.mp4";
			break;
		case "four":
			mp4Url = "https://tilastomuuttujat.github.io/kuntatilastomuuttujat/wordclouds/osa4.mp4";
			break;
		case "five":
			mp4Url = "https://tilastomuuttujat.github.io/kuntatilastomuuttujat/wordclouds/osa5.mp4";
			break;
	}

	floatingVideo.src = mp4Url;
	videoContainer.style.display = "block";
}

function closeFloatingVideo() {
	floatingVideo.pause();
	videoContainer.style.display = "none";
}

	var tekstit = [
		{"x":500,"y":40,"area":"11","color":"yellow","text":"ITSEARVOINTI AUTTAA PARANTAMAAN ITSETUNTEMUSTA<br><br>Käsitepohjaisen itsearvioinnin tavoitteena on kuvata visuaalisesti, millaiset asiat viime kädessä vaikuttavat elämänlaatuusi ja elämänkulkuusi.Tutkimusten mukaan itsetuntemus voi parantaa elämänlaatua merkittävästi.<br><br>Tarkoituksena on, että valitset itsellesi merkityksellisiä käsitteitä menneisyydestä, nykyisyydestä, tulevaisuudesta ja ajanhallinnasta. Käsitteet toimivat avaimina pohtiessasi maailmankatsomustasi, valintojasi, halujasi ja tarpeitasi.<br><br>Merkitse vahvuudet <span style='color:#27ae60'><strong>vihre&auml;ll&auml;</strong></span> (klikkaamalla itsellesi merkityksellistä käsitettä kerran) ja puutteet <strong><span style='color:#e74c3c'>punaisella</span></strong> (klikkaamalla kaksi kertaa). Valitse vain sellaiset käsitteet jotka koet tärkeäksi, olipa kyseessä vahvuutesi tai puutteesi. <br><br>Voit tehdä näitä valintojasi hyvin henkilökohtaisella tasolla, sillä arvioinneista ei kerätä lainkaan henkilötietoja. Taustatietoja kerätään tutkimuskäyttöön. Pyri olemaan itsellesi mahdollisimman rehellinen, jolloin hyödyt itsearvoinnista enemmän."},
		{"x":500,"y":490,"area":"11","color":"yellow","text":"ALOITA LUOMALLA OMAT TUNNUKSET<br><br>Tarvitset tunnuksia jos haluat tarkastella tietojasi myöhemmin, tai esitellä niitä tukihenkilöillesi. Tunnusten avulla voit tehdä itsearvointia myös osissa. Voit käyttää mitä tahansa mieleen tulevaa tunnusta ja varmennetta. Testaa haulla etteivät ne ole jo käytössä. Kadonneita tunnuksia ei voi millään palauttaa. <br><br>Esimerkki<br><strong>Tunnus</strong> Eetu <strong>Varmenne</strong> Reetu<br><br>ÄLÄ HUKKAA TUNNUKSIASI SILLÄ VAIN SINÄ TIEDÄT NE.<br><br>TÄYTÄ MYÖS TAUSTATIEDOT<br><br>Taustatietojen avulla saat tarkimmat tulokset. Taustatiedot ovat tärkeitä tutkijoille. Taustatietoja voidaan hyödyntää myös valmennusohjelmien suunnittelussa. Taustatiedoissa kuukausituloilla tarkoitetaan vain sinun tulojasi, riippumatta perheesi koosta.<br><br>LÄHETÄ LOMAKE VASTA SITTEN KUN OLET TEHNYT MYÖS VALINTOJA.<br><br><strong><span style='color:#e74c3c'>Voi sulkea tämän ohjeen klikkaamalla ?-merkkiä uudelleen.</strong></span>"},
		
		       {"x":500,"y":40,"area":"0","color":"green","text":"IKÄVIEN ASIOIDEN MERKINTÄ<br><br>Puutteet voi rinnastaa myös saavuttamattomiin ihanteisiin, jolloin niitä vastaava käsite merkitään punaisella<br><table width='400'><tr style='background-color:#eee' align='left'><td>Koulukiusaus-></td><td>Menneisyys</td><td>Kokemukset</td><td>Koulukaverit</td></tr><tr align='left'><td>Päihderiippuvuus-></td><td>Nykyisyys</td><td>Terveys</td><td>Raittius</td></tr><tr style='background-color:#eee' align='left'><td>Ylivelkaantuminen-></td><td>Ajanhallinta</td><td>Koti</td><td>Taloudellisuus</td></tr><tr align='left'><td>Yksinäisyys-></td><td>Nykyisyys</td><td>Sosiaalisuus</td><td>Ystävyys</td></tr><tr style='background-color:#eee' align='left'><td>Rahapelaaminen-></td><td>Tulevisuus</td><td>Mahdollisuudet</td><td>Riskinotto</td></tr><tr align='left'><td>Eristäytyneisyys-></td><td>Nykyisyys</td><td>Yhteisöllisyys</td><td>Yhteenkuuluvuus</td></tr><tr style='background-color:#eee' align='left'><td>Avuttomuus-></td><td>Nykyisyys</td><td>Toimintakyky</td><td>Tukiverkostot</td></tr><tr align='left'><td>Talousahdinko-></td><td>Nykyisyys<td>Yksilöllisyys</td><td>Selviytyminen</td></tr><tr style='background-color:#eee' align='left'><td>Avuttomuus-></td><td>Nykyisyys</td><td>Yhteisöllisyys</td><td>Tukiverkostot</td></tr><tr align='left'><td>Itsesyytökset-></td><td>Menneisyys<td>Uskomukset</td><td>Armollisuus</td></tr><tr style='background-color:#eee' align='left'><td>Katkeruus-></td><td>Menneisyys </td><td>Arvostukset</td><td>Oikeudenmukaisuus</td></tr><tr align='left'><td>Viha-></td><td>Menneisyys<td>Arvostukset</td><td>Turvallisuus</td></tr><tr style='background-color:#eee' align='left'><td>Valehtelu-></td><td>Nykyisyys</td><td>Vuorovaikutus</td><td>Luottamus</td></tr><tr align='left'><td>Itsekkyys-></td><td>Nykyisyys<td>Vuorovaikutus</td><td>Empaattisuus</td></tr><tr style='background-color:#eee' align='left'><td>Ahneus-></td><td>Menneisyys</td><td>Perhe</td><td>Hyväksyntä</td></tr><tr align='left'><td>Varastelu-></td><td>Menneisyys<td>Perhe</td><td>Hyväksyntä</td></tr><tr style='background-color:#eee' align='left'><td>Valittaminen-></td><td>Nykyisyys</td><td>Hyvinvointi</td><td>Tyytyväisyys</td></tr></table>"},
{"x":500,"y":490,"area":"1","color":"green","text":"VALITUT KÄSITTEET\n\nKun olet valinnut mielestäsi kaikki merkitykselliset käsitteet, voit tarkastella niitä aikapyörässä, klikkaamalla ylävalikosta kohtaa Valitut käsitteet. \n\nVoit lisätä myös omia käsitteitäsi tuplaklikkaamalla tyhjää aluetta tai vaihtaa käsitteen väriä klikkaamalla väripainiketta. Voit myös siirrellä käsitteitä, tai poistaa käsitteitä tuplaklikkaamalla väripainiketta."}, 
{"x":500,"y":40,"area":"10","color":"yellow","text":"VALITSE KÄSITTEET\n\nKlikkaa lomakkeen yläkulmassa olevaa lomakepainiketta siirtääksesi ensin lomake hetkiseksi sivuun.\n\nSen jälkeen voit ryhtyä valitsemaan itsellesi merkityksellisiä käsitteitä ryhmistä menneisyys, nykyisyys, tulevaisuus ja ajanhallinta. Valitse kunkin ryhmän ulkokehällä olevista käsitteistä vahvuutesi, klikkaamalla käsitettä kerran, ja puutteesi klikkaamalla käsitettä kaksi kertaa."},
{"x":500,"y":490,"area":"0","color":"green","text":"KÄSITTEIDEN SELITTEET\n\nNäet keskialueella käsitteiden selitteet vierittämällä hiirtä ulkokehällä käsitteiden päällä, tai valitsemalla käsitteen. Jos et haluakaan valita käsitettä, niin se poistuu valinnasta joka kolmannella klikkauksella. Pääset takaisin päävalintaan klikkaamalla valkoista keskustaa. Käy kaikki neljä aluetta läpi. Jos haluat keskeyttää ja jatkaa toisella kertaa, klikkaa painiketta Lomake ja valitse Lähetä, jolloin voit tallentaa valintasi."},



{"x":500,"y":490,"area":"10","color":"green","text":"Itsearviointia positiivisuuden kautta<br><br>Positiivinen itsearviointi auttaa rakentamaan vahvempaa itsetuntoa ja itseluottamusta. Lisäksi se voi auttaa luomaan myönteisen asenteen itseä ja ympäristöä kohtaan, mikä vaikuttaa hyvinvointiin ja henkiseen tasapainoon. On tärkeää huomata, että positiivinen itsearviointi ei ole itsekehuskelua tai ylimielisyyttä. Se on lempeää ja rehellistä suhtautumista itseen, jossa tunnistetaan oma arvo ja kyvykkyys, samalla kun ymmärretään, että jokaisella on omat vahvuutensa ja kehittämisen alueensa."},



{"x":500,"y":40,"area":"30","color":"green","text":"HAVANNOI SIJOITTELUA<br><br>Jos olet valinnut käsitteesi huolella, tulisi sinun nähdä itsellesi merkitykselliset asiat samassa kuviossa. Tarkastele värillisten pallojen osuutta eri vyöhykkeillä. Rakenna jonkinlainen tarina käsitteiden ympärille. Mieti selittääkö jokin käsite myöhempiä valintojasi. Pohdi kuinka paljon elät ajanhermolla, nykyisyydessä, menneisyydessä vai tulevaisuudessa. Ovatko vihreät vai punaiset pallot enemmistönä. Jos et ole vielä tallentanut tietojasi, klikkaa Lomake -painiketta ja valitse Lähetä."},
		       {"x":500,"y":40,"area":"40","color":"green","text":"KÄSITTEIDEN VÄLISET SIDOKSET\nVoit tarkastella myös tekoälyavusteista karttaa käsitteiden välisistä sidoksista vuorovaikutteisesti. Klikkaa ylävalikon kohtaa Käsitteiden väliset sidokset. Valitsemasi käsitteet näkyvät suurina palloina, ja taustakäsitteet keltaisina, pinkkeinä ja vihreinä pallukoina. Keltaiset pallukat toimivat taustalla ohjaavina tekijöinä muita enemmän. Saat tarkemman käsityksen sidoksista klikkaamalla palloja. Taustatekijöiden tarkoituksena on tarjota lisävalaistusta valitsemillesi käsitteille."},
		       {"x":500,"y":40,"area":"50","color":"green","text":"VERTAILU<br><br>Voit vertailla asemaasi suhteessa muihin. Säteiden pituudet kuvaavat voimakkuutta. Kaksi suurempaa kehää kuvaavat valintojesi pohjalta olevia ryhmiä. Vasemmanpuoleinen sädekehä, elämänkulku, kuvaa ihmisen elämän eri vaiheita, kokemuksia ja kehitystä ajan myötä. Se korostaa elämän matkaa syntymästä kuolemaan ja sisältää kaikki ne käsitteet, jotka liittyvät ihmisen yksilöllisyyteen, suhteisiin, tavoitteisiin ja kokemuksiin elämän eri vaiheissa. Oikeanpuoleinen sädekehä, elämänlaatu, liittyy ihmisen kokemukselliseen hyvinvointiin ja tyytyväisyyteen elämän eri osa-alueilla. Se heijastaa ihmisen terveyttä, toimintakykyä, tietoja, taitoja ja tyytyväisyyttä työhön, kotiin, vapaa-aikaan, kulttuuriin, sukuun ja perheeseen."},
		       {"x":500,"y":490,"area":"50","color":"green","text":"KEHITÄ ITSETUNTEMUSTASI\n\nToivottavasti tämä itsearviointi avasi jo hieman silmiäsi sinulle merkityksellisistä asioista, ja millä tavoin ne vaikuttavat elämänkulkuusi.\nPidä tunnuksesi muistissa, jolloin voit palata tarkastelemaan tietojasi niin usein kuin haluat. Voit esitellä tietojasi myös tukihenkilöillesi.\nHuomaathan, että itsearvoinninssa ei kerätä lainkaan henkilötietoja.\n\nKIITOS OSALLISTUMISESTASI"}
		      ];

var alkuinfo = "Tervetuloa itsearvioinnin pariin. Itsearvioinnin tavoitteena on lisätä itsetuntemusta ja sitä kautta pyrkiä lisäämään elämänlaatua.\n\nSivun vasemmassa yläkulmassa oleva ?-merkki, avaa ja sulkee toimintokohtaiset ohjeet vuorotellen.\nOhjevideo 1 käsittelee kohtia 1-3,\nohjevideo 2 kohtaa 4, ohjevideo 3 kohtaa 5,\nohjevideo 4 kohtaa 6 ja ohjevide 5 kohtaa 7.\n\nNäin käytät itsearvointia\n1. Määritä ensin tunnus ja varmenne jos haluat hyödyntää tietojasi myöhemmin. Testaa ovatko ne jo käytössä Hae -painikkeella.\n2. Valitse itseäsi koskevat taustatiedot\n3. Siirrä lomake sivuun Lomake -painikkeesta\n4. Valitse itsellesi merkitykselliset käsitteet ryhmistä\nMenneisyys, Nykyisyys, Tulevaisuus ja Ajanhallinta\n5. Näet valintasi kohdassa Valitut käsitteet\n6. Käsitteiden väliset sidokset on tekoälyn muodostama kuvio\n7. Kohdassa vertailu voit vertailla valintojasi";

document.getElementById("message").value = alkuinfo;

	function infoCircle(x, y, text, color) {
		var newCircle = {
			x: x,
			y: y,
			text: text,
			color: color
		};
		var svg1 = d3.select("#overlay");
		//dataset.push(newCircle);
		var circleGroup = svg1.append("div").datum(newCircle).attr("class", "circle-group").style("left", function(d) {
			return d.x + "px";
		}).style("top", function(d) {
			return d.y + "px";
		});

	circleGroup.append("xhtml:div")
   .attr("class", "info-field")
   .style("font", "14px Gill Sans")
   .style("color", "gray")
   .style("background-color","rgba(255,255,255,0.5)")
   .html(function(d) { return d.text; });
	}

	function toggleOpen() {

document.getElementById("toggle-overlay-button").style.backgroundColor = "#337ab7";
overlay.style.display = "none";
lomakeohje = 1 - lomakeohje;
			console.log(lomakeohje);
	var element = document.getElementById("sideForm");
	    element.classList.toggle("open");
		saveCircles();
	}
	var lomakeohje = "1";
	var ruutuohje = "1";
	var ohjeruutu = "11";
	var taso = "";
	var snartti = 0;
	var kuitti = 1;
	var yhteen="green";
	
	document.getElementById("toggle-overlay-button1").textContent = "Vahvuudet";
	document.getElementById("toggle-overlay-button1").style.backgroundColor = "green";
	
	function kasitteet() {
		ohjeruutu = "10";
	}

	
	function toggleOverlay1() {
	if(yhteen === "green") {
	yhteen = "red";
	document.getElementById("toggle-overlay-button1").textContent = "Puutteet";
	document.getElementById("toggle-overlay-button1").style.backgroundColor = "red";
	} else {
	document.getElementById("toggle-overlay-button1").textContent = "Vahvuudet";
	document.getElementById("toggle-overlay-button1").style.backgroundColor = "green";
	yhteen = "green";
	}
	vertailu(yhteen);
	}
	
	
	function toggleOverlay() {
	
		if(snartti < 1) {
			overlay.style.display = "block";
			document.getElementById("toggle-overlay-button").style.backgroundColor = "red";
			//var lomakeohje = "1";
		} else {
			if(overlay.style.display === "none") {
			document.getElementById("toggle-overlay-button").style.backgroundColor = "#337ab7";
				overlay.style.display = "block";
				document.getElementById("toggle-overlay-button").style.backgroundColor = "red";
				//var lomakeohje = "1";
			} else {
				overlay.style.display = "none";
				document.getElementById("toggle-overlay-button").style.backgroundColor = "#337ab7";
				//var lomakeohje = "0";
			}
		}
		snartti = 1;
		if(lomakeohje === "1") {
		//ohjeruutu = ruutuohje+lomakeohje;
		} else {
		//ohjeruutu = ruutuohje;
		}
		console.log(ohjeruutu);
    d3.selectAll("#overlay > *").remove();
	tekstit.forEach(function(d) {
	
	//console.log(ohjeruutu);
	if(d.area == ohjeruutu)
			infoCircle(d.x, d.y, d.text, d.color);
		});	
				
	}
	
			// add
		var url1 = "https://script.google.com/macros/s/AKfycbw59U7SsmAqpfFO0yEuE3ndij2XYJhzPG_Wm0gZYUR2QxwPBJFsNPYHnmvDoiFZUbNWJA/exec?callback=loadData";

		
		// update
		var url2 = "https://script.google.com/macros/s/AKfycbw59U7SsmAqpfFO0yEuE3ndij2XYJhzPG_Wm0gZYUR2QxwPBJFsNPYHnmvDoiFZUbNWJA/exec?callback=loadData";
		
		
		var url = url1;
	
	
	
	
	document.getElementById("dataForm").addEventListener("submit", function(event) {
		event.preventDefault(); // Prevent the form from submitting normally
		var name = document.getElementById("name").value;
		var pin = document.getElementById("pin").value;
		var gender = document.getElementById("gender").value;
		var age = document.getElementById("age").value;
		var education = document.getElementById("education").value;
		var activity = document.getElementById("activity").value;
		var family = document.getElementById("family").value;
		var income = document.getElementById("income").value;
		var location = document.getElementById("location").value;
		var message = document.getElementById("message").value;
		
		var data = {
			name: name,
			pin: pin,
			gender: gender,
			age: age,
			education: education,
			activity: activity,
			family: family,
			income: income,
			location: location,
			message: message
		};
		// Make an AJAX call to Google Script
		$.ajax({
			url: url,
			method: "GET",
			dataType: "jsonp",
			data: data,
			success: function(response) {console.log(response);},
			error: function(error) {console.error(error);}
		});
	});
	// Log the returned data
	function loadData(response) {
	document.getElementById('kuittaus').innerHTML = 'Kiitos osallistumisesta ';
	document.getElementById('kuittaus1').innerHTML = '';
		console.log(response);
		//console.error(error);
	}

	function init() {
		var form = document.getElementById('hae');
		form.addEventListener('submit', fetchData);
	}

	function fetchData(event) {
		event.preventDefault();
		var name = document.getElementById('name').value;
		var pin = document.getElementById('pin').value;
		var url = 'https://docs.google.com/spreadsheets/d/1rS5f0lQMK3OqIGZlyq9WipkuX6XD5txhFboqCq7dQvM/gviz/tq?sheet=Sheet1&headers=1';
		var query = new google.visualization.Query(url);
		query.setQuery("select A,B,C,D,E,F,G,H,I,J,K where B='" + name + "' and C='" + pin + "' order by A desc limit 1");
		query.send(processSheetsData);
	}

	function processSheetsData(response) {
		var array = [];
		var data = response.getDataTable();
		var columns = data.getNumberOfColumns();
		var rows = data.getNumberOfRows();
		console.log(rows);
if(rows>0){	
		for(var r = 0; r < rows; r++) {
			var row = {};
			for(var c = 0; c < columns; c++) {
				var columnName = data.getColumnLabel(c);
				row[columnName] = data.getFormattedValue(r, c);
			}
			array.push(row);
		}
		document.getElementById("name").value = array[0].name;
		document.getElementById("pin").value = array[0].pin;
		document.getElementById("gender").value = array[0].gender;
		document.getElementById("age").value = array[0].age;
		document.getElementById("activity").value = array[0].activity;
		document.getElementById("education").value = array[0].education;
		document.getElementById("family").value = array[0].family;
		document.getElementById("income").value = array[0].income;
		document.getElementById("location").value = array[0].location;
		document.getElementById("message").value = array[0].message;
		document.getElementById('kuittaus1').innerHTML = 'Tiedot haettu ';
		document.getElementById('kuittaus').innerHTML = '';
} else {

		//document.getElementById("name").value = "";
		//document.getElementById("pin").value = "";
		document.getElementById("gender").value = "";
		document.getElementById("age").value = "";
		document.getElementById("activity").value = "";
		document.getElementById("education").value = "";
		document.getElementById("family").value = "";
		document.getElementById("income").value = "";
		document.getElementById("location").value = "";
		document.getElementById("message").value = "[]";	
		document.getElementById('kuittaus1').innerHTML = 'Ei aiempia merkintöjä ';
		document.getElementById('kuittaus').innerHTML = '';
	} 
	updateCircles();
	}

	google.charts.load('current');
	google.charts.setOnLoadCallback(init);
		
	const marginTop = 0,
		marginRight = 0,
		marginBottom = 0,
		marginLeft = 0,
		maxWords = 100,
		fontFamily = "sans-serif",
		fontScale = 15,
		padding = 0,
		rotate = 0;
	var dataset = [];
	var taulukko = [];
	var info = "";
	//d3.json("https://tilastomuuttujat.github.io/kuntatilastomuuttujat/wordclouds/flare-2.json").then(data => {
      d3.json("flare-2.json").then(data => {	
		partition = data => {
			const root = d3.hierarchy(data).sum(d => d.size).sort((a, b) => b.value - a.value);
			return d3.partition().size([2 * Math.PI, root.height + 1])
				(root);
		}
		//var color = d3.scaleOrdinal().domain([]).range(['#08A789', '#00AEEF', '#FFEA82', '#F79435', '#00AEEF', '#000000', '#ED1D24', '#CA1111']);
		var color = d3.scaleOrdinal().range(d3.quantize(d3.interpolateRainbow, data.children.length + 1));
		var format = d3.format(",d");
		var width = 800;
		var radius = width / 6;
		var arc = d3.arc().startAngle(d => d.x0).endAngle(d => d.x1).padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005)).padRadius(radius * 1.5).innerRadius(d => d.y0 * radius).outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1))
		const root = partition(data);
		root.each(d => d.current = d);
		const svg = d3.select("#wheel").append("svg").attr("width", width).attr("height", width);
		const g = svg.append("g").attr("transform", `translate(${width / 2},${width / 2})`);
		const path = g.append("g").selectAll("path").data(root.descendants().slice(1)).enter().append("path").attr("fill", d => {
			while(d.depth > 1) d = d.parent;
			return color(d.data.name);
		}).attr("fill-opacity", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0).attr("d", d => arc(d.current)).on("mouseover", mouseover).on("click", clicked);
		/*
		    path.append("title")
		        .text(d => `${d.ancestors().map(d => d.data.name).reverse().join("/")}\n${format(d.value)}`);
		*/
		const label = g.append("g").attr("pointer-events", "none").attr("text-anchor", "middle").style("user-select", "none").selectAll("text").data(root.descendants().slice(1)).enter().append("text").attr("dy", "0.35em").attr("fill-opacity", d => +labelVisible(d.current)).attr("transform", d => labelTransform(d.current)).text(d => d.data.name);
		const text = info;
		const textContainer = svg.append("foreignObject").attr("x", 310).attr("y", 310).attr("width", 200).attr("height", 180);
		const div = textContainer.append("xhtml:div").style("width", "100%").style("height", "100%").style("font-size", "0.7em").style("overflow", "auto").style("word-wrap", "break-word").style("white-space", "normal").html(text);
		div.selectAll("p").data([text]).enter().append("p").text(function(d) {
			return d;
		});
		const parent = g.append("circle").datum(root).attr("r", radius).attr("fill", "none").attr("pointer-events", "all").on("click", clicked);

function clicked(p) {
ohjeruutu = "0";
    if (p.depth < 2) {
        taso = p.data.name;
    }

    if (p.depth < 3 && p.depth !== 2) {
        parent.datum(p.parent || root);
        root.each(d => d.target = {
            x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
            x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
            y0: Math.max(0, d.y0 - p.depth),
            y1: Math.max(0, d.y1 - p.depth)
        });
        const t = g.transition().duration(750);
        path.transition(t).tween("data", d => {
            const i = d3.interpolate(d.current, d.target);
            return t => d.current = i(t);
        }).filter(function(d) {
            return +this.getAttribute("fill-opacity") || arcVisible(d.target);
        }).attr("fill-opacity", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0).attrTween("d", d => () => arc(d.current));
        label.filter(function(d) {
            return +this.getAttribute("fill-opacity") || labelVisible(d.target);
        }).transition(t).attr("fill-opacity", d => +labelVisible(d.target)).attrTween("transform", d => () => labelTransform(d.current));

    } else {
ohjeruutu = "0";
    document.getElementById("toggle-overlay-button").style.backgroundColor = "#337ab7";
overlay.style.display = "none";
        const text = d3.select(this);
        const textColor = text.style("fill");
        var otherChildName = p.data.name;
        var otherParentParentName = findParentParentName(data, otherChildName);
        if (otherParentParentName === taso) {
            textContainer.text(p.data.info);
            info = p.data.info;
            var alkuperainenVari = text.attr("data-original-color"); 
            if (textColor === "rgb(26, 199, 194)" || textColor === "rgb(110, 64, 170)" || textColor === "rgb(175, 240, 91)" || textColor === "rgb(255, 94, 99)") {
                text.style("fill", "green");
                const feeling = text.text();
                console.log("Klikkaus:", "green", p.data.name);
                lisaaTieto(p.data.x, p.data.y, p.data.name, "green");
            } else if (textColor === "green") {
                text.style("fill", "red");
                const feeling = text.text();
                console.log("Klikkaus:", "red", p.data.name);
                lisaaTieto(p.data.x, p.data.y, p.data.name, "red");
            } else {
                // Kolmas klikkaus - palauta alkuperäinen väri
                text.style("fill", alkuperainenVari);
                const feeling = text.text();
                console.log("Klikkaus:", alkuperainenVari, p.data.name);
                lisaaTieto(p.data.x, p.data.y, p.data.name, alkuperainenVari);
            }
        }
    }
}



		function mouseover(d) {
			var otherChildName = d.data.name;
			var otherParentParentName = findParentParentName(data, otherChildName);
			if(otherParentParentName === taso) {
				textContainer.text(d.data.info);
				textContainer.style("line-height", "0.8");
				textContainer.style("font-size", "0.7em");
			}
		}
		function findParentParentName(data, childName, parentParentName = null) {
			if(data.children) {
				for(var i = 0; i < data.children.length; i++) {
					var parent = data.children[i];
					if(parent.children) {
						for(var j = 0; j < parent.children.length; j++) {
							var child = parent.children[j];
							if(child.name === childName) {
								return parentParentName;
							}
						}
					}
					var parentParent = findParentParentName(parent, childName, parent.name);
					if(parentParent) {
						return parentParent;
					}
				}
			}
			return null;
		}
function lisaaTieto(x, y, text, color) {
    if (color != "green" && color != "red") {
        for (var i = 0; i < dataset.length; i++) {
            if (dataset[i].text === text) {
                dataset.splice(i, 1);
                break;
            }
        }
    } else {
        var loytyi = false;
        for (var i = 0; i < dataset.length; i++) {
            if (dataset[i].text === text) {
                dataset[i].color = color;
                loytyi = true;
                break;
            }
        }
        if (!loytyi) {
            dataset.push({
                x: x,
                y: y,
                text: text,
                color: color
            });
        }
    }
    console.log(dataset);
    saveCircles();
}
	
		function arcVisible(d) {
			return d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;
		}

		function labelVisible(d) {
			return d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;
		}

		function labelTransform(d) {
			const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;
			const y = (d.y0 + d.y1) / 2 * radius;
			return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;
		}
	});
	var lson = JSON.stringify([]);
	document.getElementById("message").value = lson;
	var color = d3.scaleOrdinal(d3.schemeAccent);
	var svg = d3.select("#canvas");
	svg.style("background-image", "url('https://tilastomuuttujat.github.io/kuntatilastomuuttujat/wordclouds/elonkeha_tausta.svg')");
	
	function addCircle(x, y, text, color) {
		var newCircle = {
			x: x,
			y: y,
			text: text,
			color: color
		};
		dataset.push(newCircle);
		var circleGroup = svg.append("div").datum(newCircle).attr("class", "circle-group").style("left", function(d) {
			return d.x + "px";
		}).style("top", function(d) {
			return d.y + "px";
		});
		circleGroup.append("div").attr("class", "circle").style("background-color", function(d) {
			return d.color;
		}).on("click", function(d) {
			changeColor(d, this);
		}).on("dblclick", function(d) {
			removeCircle(circleGroup);
		});
		circleGroup.append("textarea").attr("class", "text-field").style("font", "14px Gill Sans")
			//.style("border", function(d) { return " solid " + d.color; })
			.text(function(d) {
				return d.text;
			}).on("input", function(d) {
				d.text = this.value;
				updateCircleText(circleGroup, d.text);
				
			});
		circleGroup.call(d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended));
	}

	function removeCircle(circleGroup) {
		var circleData = circleGroup.datum();
		var index = dataset.indexOf(circleData);
		if(index > -1) {
			dataset.splice(index, 1);
		}
		circleGroup.remove();
		saveCircles();
	}
/*
	function changeColor(circleData, circleElement) {
		var newColor = color(circleData.color);
		circleData.color = newColor;
		d3.select(circleElement).style("background-color", newColor);
	}
*/
    function changeColor(circleData, circleElement) {
        var newColor = circleData.color === "green" ? "red" : "green";
        circleData.color = newColor;
        d3.select(circleElement).style("background-color", newColor);
    }


	function updateCircleText(circleGroup, newText) {
		circleGroup.select(".text-field").property("value", newText);
	}

	function saveCircles() {
		var json = JSON.stringify(dataset);
		document.getElementById("message").value = json;
		updateCircles();
	}

	function updateCircles() {
		var json = document.getElementById("message").value;
		var updateset = JSON.parse(json);
		dataset = [];
		d3.selectAll(".circle-group").remove();
		updateset.forEach(function(d) {
			//console.log(d.x, d.y, d.text, d.color);
			addCircle(d.x, d.y, d.text, d.color);
		});
		//console.log(updateset);
	}

	function AnalyzeReds() {
		ohjeruutu = "40";
		muuttujat = [];
		for(var i = 0; i < dataset.length; i++) {
			muuttujat.push(dataset[i].text);
		}
		d3.selectAll("#svganchor > *").remove();
		kartta();
	}

	function kartta() {
	ohjeruutu="40";
		(function newsQuestConnectivityRisks() {
			var w = 1200;
			var h = 900;
			var padding = [10, 10, 10, 10];
			var colors = d3.scaleOrdinal().domain([]).range(['#08A789', '#8F53A1', '#FFEA82', '#F79435', '#00AEEF', '#000000', '#ED1D24', '#CA1111']);
			var svg = d3.select("#svganchor").append("svg").attr("width", w).attr("height", h);
			var nodesTotal = [];
			var linksTotal = [];
			const things = new Object();
			things.thing = new Array();
			d3.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQVW3lFxFzmsO61waUKVTSQU9R1RhYjinnTLFcia2MQ2mLw0Wu0tG0HLFvpXLmJAJjG1wjq6Q6ObgWI/pub?gid=1193425325&single=true&output=csv").then(function(apiData) {
				try {
					localStorage.setItem("eriarvoisuusvarasto", JSON.stringify({
						data: d3.csvFormat(apiData),
						timestamp: currentDate.getTime()
					}));
				} catch (error) {};
				var mapiData = [];
				for(var i = 0; i < apiData.length; i++) {
					if(muuttujat.indexOf(apiData[i].source) > -1) mapiData.push(apiData[i]);
				}
				apiData = mapiData;
				for(var i = 0; i < apiData.length; i++) {
					things.thing.push({
						id: apiData[i].source,
						labelText: apiData[i].source
					});
					things.thing.push({
						id: apiData[i].target,
						labelText: apiData[i].target
					});
				}
				const uniqueArray = things.thing.filter((thing, index) => {
					const _thing = JSON.stringify(thing);
					return index === things.thing.findIndex(obj => {
						return JSON.stringify(obj) === _thing;
					});
				});
				nodesTotal = uniqueArray;
				linksTotal = apiData;
			});

			function checkFlag() {
				if(things.thing.length == 0) {
					window.setTimeout(checkFlag, 3000);
				} else {
					finit();
				}
			}
			checkFlag();

			function finit() {
				var simulation = d3.forceSimulation().force("link", d3.forceLink().id(function(d) {
					return d.id;
				})).force("collide", d3.forceCollide(function(d) {
					return Math.sqrt(d.radius) * 11
				})).force("charge", d3.forceManyBody()).force("center", d3.forceCenter(w / 3, h / 2));
				draw(nodesTotal, linksTotal);

				function draw(nodes, links) {
					var nodesConnectionsList = nodes.map(function(d) {
						return d.id
					});
					var nodesConnections = [];
					nodesConnectionsList.forEach(function(d, j) {
						nodesConnections[j] = {
							risk: d,
							connections: []
						};
						for(var i = 0; i < links.length; i++) {
							if(links[i].source == d) {
								nodesConnections[j].connections.push({
									connection: links[i].target,
									connectionsNumber: links[i].value
								})
							} else if(links[i].target == d) {
								nodesConnections[j].connections.push({
									connection: links[i].source,
									connectionsNumber: links[i].value
								})
							}
						}
					});
					nodes.forEach(function(d) {
						var thisData = nodesConnections.filter(function(e) {
							return e.risk == d.id
						});
						var sum = d3.sum(thisData[0].connections, function(f) {
							return f.connectionsNumber
						});
						d["radius"] = sum;
					});
					var nodeById = d3.map(nodes, function(d) {
						return d.id;
					})
					var bilinks = [];
					links.forEach(function(link) {
						var s = link.source = nodeById.get(link.source),
							t = link.target = nodeById.get(link.target),
							i = {},
							val = {
								lvalue: link.value
							};
						nodes.push(i);
						links.push({
							source: s,
							target: i
						}, {
							source: i,
							target: t
						});
						if(t.radius > 2) {
							bilinks.push([s, i, t, val]);
							//console.log(	s, i, t, val);
						}
					});
					var link = svg.selectAll(".link").data(bilinks).enter().append("path").attr("stroke-width", function(d) {
						return d[3].lvalue / 1.5 < 1 ? 1 : d[3].lvalue / 1.5;
					}).attr("class", "link");
					var node = svg.selectAll(".node").data(nodes.filter(function(d) {
						if(d.radius > 2) return d.id;
					})).enter().append("g").attr("class", "node").call(d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended));
					var circles = node.append("circle").attr("r", function(d) {
						return Math.sqrt(d.radius) * 4
					}).attr("fill", function(d) {
						if(d.radius > 40) return "#ee1a16";
						if(d.radius > 9 && d.radius < 40) return "#f3d776";
						if(d.radius > 5 && d.radius < 9) return "#f32876";
						if(d.radius < 5) return colors(d.group);
					});
					var backText = node.append("text").attr("class", "nodesLabelBack").attr("opacity", function(d) {
						return d.radius == 0 ? 0 : 1
					}).attr("dx", function(d) {
						return Math.sqrt(d.radius) * 4 + 2
					}).attr("dominant-baseline", function(d) {
						if(!(d.labelText.split(" ")[1])) {
							return "central"
						}
					}).text(function(d) {
						return d.labelText.split(" ")[0]
					}).append("tspan").attr("x", function(d) {
						return Math.sqrt(d.radius) * 4 + 2
					}).attr("dy", 10).text(function(d) {
						return d.labelText.split(" ")[1]
					});
					var nodesText = node.append("text").attr("class", "nodesLabel").attr("opacity", function(d) {
						return d.radius == 0 ? 0 : 1
					}).attr("dx", function(d) {
						return Math.sqrt(d.radius) * 4 + 2
					}).attr("dominant-baseline", function(d) {
						if(!(d.labelText.split(" ")[1])) {
							return "central"
						}
					}).text(function(d) {
						return d.labelText.split(" ")[0]
					}).append("tspan").attr("x", function(d) {
						return Math.sqrt(d.radius) * 4 + 2
					}).attr("dy", 10).text(function(d) {
						return d.labelText.split(" ")[1]
					});
					circles.on("mouseover", function(d) {
						hovered(d);
					}).on("mouseout", function(d) {
						hoverOut(d);
					});
					link.on("mouseover", function(d) {
						hoveredLink(d);
					}).on("mouseout", function(d) {
						hoverLinkOut(d);
					});
					simulation.nodes(nodes).on("tick", ticked);
					simulation.force("link").links(links);
					//drawLegend();
					function ticked() {
						link.attr("d", positionLink);
						node.attr("transform", positionNode);
					}

					function positionLink(d) {
						return "M" + d[0].x + "," + d[0].y + "S" + d[1].x + "," + d[1].y + " " + d[2].x + "," + d[2].y;
					}

					function positionNode(d) {
						if(d.x < 20) {
							d.x = 20
						};
						if(d.y < 20) {
							d.y = 20
						};
						if(d.x > 1200) {
							d.x = 1200
						};
						if(d.y > 900) {
							d.y = 900
						};
						return "translate(" + d.x + "," + d.y + ")";
					}

					function hovered(thisData) {
						//drawRisk(thisData);
						var thisNodeConnections = nodesConnections.filter(function(d) {
							return d.risk == thisData.id;
						});
						var thisNodeConnectionsList = thisNodeConnections[0].connections.map(function(d) {
							return d.connection;
						});
						thisNodeConnectionsList.push(thisData.id);
						node.attr("opacity", function(d) {
							return thisNodeConnectionsList.indexOf(d.id) > -1 ? 1 : 0.1;
						});
						link.attr("stroke-opacity", function(d) {
							return (d[0].id == thisData.id || d[2].id == thisData.id) ? 1 : 0.1;
						});
					}

					function hoverOut(thisData) {
						node.attr("opacity", 1);
						link.attr("stroke-opacity", 1);
						//drawLegend();
					}

					function hoveredLink(thisData) {
						//drawLink(thisData);
						link.attr("stroke-opacity", function(d) {
							return (d[1].index == thisData[1].index) ? 1 : 0.1;
						});
						node.attr("opacity", function(d) {
							return (d.id == thisData[0].id || d.id == thisData[2].id) ? 1 : 0.1;
						});
					}

					function hoverLinkOut(thisData) {
						node.attr("opacity", 1);
						link.attr("stroke-opacity", 1);
						//drawLegend();
					}
					//end of draw
				}

				function dragstarted(d) {
					if(!d3.event.active) simulation.alphaTarget(0.3).restart();
					d.fx = d.x;
					d.fy = d.y;
				}

				function dragged(d) {
					d.fx = (d3.event.x > 1200) ? 1200 : (d3.event.x < 30) ? 30 : d3.event.x;
					d.fy = (d3.event.y > 900) ? 900 : (d3.event.y < 30) ? 30 : d3.event.y;
				}

				function dragended(d) {
					if(!d3.event.active) simulation.alphaTarget(0);
					d.fx = null;
					d.fy = null;
				}
				//end of finit
			}
			//end of newsQuestConnectivityRisks	
		}());
	} //end of kartta
	function handleDoubleClick() {
		var mousePos = d3.mouse(this);
		var x = mousePos[0];
		var y = mousePos[1];
		var isCircle = d3.select(d3.event.target).classed("circle");
		if(!isCircle) {
			addCircle(x, y, "uusi", "red");
		}
	}

	function dragstarted(d) {
		d3.select(this).raise().classed("active", true);
	}

	function dragged(d) {
		d.x = d3.event.x;
		d.y = d3.event.y;
		d3.select(this).style("left", d.x + "px").style("top", d.y + "px");
	}

	function dragended(d) {
		d3.select(this).classed("active", false);
	}

function vertailu(vari) {
		ohjeruutu = "50";
		
			
    (function() {
      var margin = { top: 20, right: 10, bottom: 10, left: 10 },
        width = 140,
        height = 140,
        r = 8;

      var vars = {
      kokemukset: "Kokemukset",
      yksilollisyys: "Yksilöllisyys",
      sosiaalisuus: "Sosiaalisuus",
      yhteisollisyys: "Yhteisöllisyys",
      tavoitteet: "Tavoitteet",
      haaveet: "Haaveet",
      mahdollisuudet: "Mahdollisuudet",
      tarkeys: "Tärkeys",
      jarjestys: "Järjestys",
      ajoitus: "Ajoitus",
      arvostukset: "Arvostukset",
      uskomukset: "Uskomukset"
      };
      
      var mars = {
      perhe: "Perhe",
      terveys: "Terveys",
      hyvinvointi: "Hyvinvointi",
      toimintakyky: "Toimintakyky",
      taidot: "Taidot",
      tiedot: "Tiedot",
      kyvyt: "Kyvyt",
      tyo: "Työ",
      koti: "Koti",
      vapaa: "Vapaa-aika",
      kulttuuri: "Kulttuuri",
      suku: "Suku"
      };

var data1 = [];
var tiedot = dataset;
/*
var tiedot = [
{"x":279,"y":10,"text":"Vastarakkaus","color":"green"},{"x":280,"y":60,"text":"Koulukaverit","color":"red"},{"x":280,"y":85,"text":"Ensirakkaus","color":"green"},{"x":200,"y":300,"text":"Perinteellisyys","color":"red"},{"x":232,"y":352,"text":"Vanhoillisuus","color":"red"},{"x":350,"y":300,"text":"Sisaruus","color":"red"},{"x":350,"y":225,"text":"Äiti","color":"red"},{"x":-15,"y":440,"text":"Tasavertaisuus","color":"green"},{"x":360,"y":345,"text":"Oikeudenmukaisuus","color":"green"},{"x":-20,"y":120,"text":"Henkisyys","color":"green"},{"x":458,"y":34,"text":"Avarakatseisuus","color":"green"},{"x":632,"y":60,"text":"Itsetuntemus","color":"green"},{"x":458,"y":112,"text":"Yksinolo","color":"green"},{"x":705,"y":161,"text":"Empaattisuus","color":"green"},{"x":450,"y":334,"text":"Mielenrauha","color":"green"},{"x":450,"y":209,"text":"Rauhallisuus","color":"green"},{"x":570,"y":420,"text":"Kiitollisuus","color":"green"},{"x":570,"y":345,"text":"Tyytyväisyys","color":"green"},{"x":600,"y":435,"text":"Jaksavuus","color":"red"},{"x":600,"y":485,"text":"Liikkuvuus","color":"red"},{"x":725,"y":365,"text":"Vastuullisuus","color":"green"},{"x":450,"y":425,"text":"Kasvu","color":"green"},{"x":725,"y":475,"text":"Kärsivällisyys","color":"green"},{"x":725,"y":525,"text":"Pitkäjännitteisyys","color":"green"},{"x":635,"y":735,"text":"Luovuus","color":"green"},{"x":635,"y":810,"text":"Riskinotto","color":"red"},{"x":550,"y":675,"text":"Päättelykyky","color":"green"},{"x":550,"y":750,"text":"Ymmärrys","color":"green"},{"x":630,"y":575,"text":"Koulutus","color":"red"},{"x":725,"y":650,"text":"Intohimo","color":"green"},{"x":340,"y":575,"text":"Luotettavuus","color":"green"},{"x":340,"y":625,"text":"Ongelmanratkaisu","color":"green"},{"x":165,"y":625,"text":"Säästäväisyys","color":"green"},{"x":165,"y":675,"text":"Taloudellisuus","color":"green"},{"x":165,"y":650,"text":"Siisteys","color":"red"},{"x":0,"y":475,"text":"Ulkoilevuus","color":"red"},{"x":279,"y":37,"text":"Seksuaalisuus","color":"red"}];
*/      
var ydata = [];

var xdata = [];

    var zdata = [
{"Luokka":"Ajanhallinta","Ryhma":"Ajoitus","Muuttuja":"Aikataulutus"},{"Luokka":"Ajanhallinta","Ryhma":"Ajoitus","Muuttuja":"Ajankohtaisuus"},{"Luokka":"Ajanhallinta","Ryhma":"Ajoitus","Muuttuja":"Ennakoivuus"},{"Luokka":"Ajanhallinta","Ryhma":"Ajoitus","Muuttuja":"Itsekontrolli"},{"Luokka":"Ajanhallinta","Ryhma":"Ajoitus","Muuttuja":"Keskittyvyys"},{"Luokka":"Ajanhallinta","Ryhma":"Ajoitus","Muuttuja":"Oikea-aikaisuus"},{"Luokka":"Ajanhallinta","Ryhma":"Ajoitus","Muuttuja":"Täsmällisyys"},{"Luokka":"Ajanhallinta","Ryhma":"Järjestys","Muuttuja":"Delegoivuus"},{"Luokka":"Ajanhallinta","Ryhma":"Järjestys","Muuttuja":"Itsekuri"},{"Luokka":"Ajanhallinta","Ryhma":"Järjestys","Muuttuja":"Järjestelmällisyys"},{"Luokka":"Ajanhallinta","Ryhma":"Järjestys","Muuttuja":"Priorisoivuus"},{"Luokka":"Ajanhallinta","Ryhma":"Järjestys","Muuttuja":"Strategisuus"},{"Luokka":"Ajanhallinta","Ryhma":"Järjestys","Muuttuja":"Suunnitelmallisuus"},{"Luokka":"Ajanhallinta","Ryhma":"Järjestys","Muuttuja":"Tarpeellisuus"},{"Luokka":"Ajanhallinta","Ryhma":"Järjestys","Muuttuja":"Valikoivuus"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Kätevyys"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Käytännöllisyys"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Lapset"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Lemmikit"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Puhtaus"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Puoliso"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Rutiininomaisuus"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Säästäväisyys"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Siisteys"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Taloudellisuus"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Uskollisuus"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Vauraus"},{"Luokka":"Ympäristö","Ryhma":"Koti","Muuttuja":"Viihtyvyys"},{"Luokka":"Ajanhallinta","Ryhma":"Tärkeys","Muuttuja":"Hygienisyys"},{"Luokka":"Ajanhallinta","Ryhma":"Tärkeys","Muuttuja":"Hyödyllisyys"},{"Luokka":"Ajanhallinta","Ryhma":"Tärkeys","Muuttuja":"Kutsumus"},{"Luokka":"Ajanhallinta","Ryhma":"Tärkeys","Muuttuja":"Tarpeet"},{"Luokka":"Ajanhallinta","Ryhma":"Tärkeys","Muuttuja":"Vaikuttaminen"},{"Luokka":"Ajanhallinta","Ryhma":"Tärkeys","Muuttuja":"Vakaus"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Aikaansaavuus"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Asiantuntemus"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Johtajuus"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Luotettavuus"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Noudattavuus"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Ongelmanratkaisu"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Säännöllisyys"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Sitoutuvuus"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Soveltuvuus"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Suorituskykyisyys"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Tehokkuus"},{"Luokka":"Ympäristö","Ryhma":"Työ","Muuttuja":"Yhteistyökykyisyys"},
{"Luokka":"Ympäristö","Ryhma":"Vapaa-aika","Muuttuja":"Harrastavuus"},
{"Luokka":"Ympäristö","Ryhma":"Vapaa-aika","Muuttuja":"Monipuolisuus"},
{"Luokka":"Ympäristö","Ryhma":"Vapaa-aika","Muuttuja":"Rentoutuvuus"},
{"Luokka":"Ympäristö","Ryhma":"Vapaa-aika","Muuttuja":"Ulkoilevuus"},
{"Luokka":"Ympäristö","Ryhma":"Vapaa-aika","Muuttuja":"Viihdyttävyys"},
{"Luokka":"Ympäristö","Ryhma":"Vapaa-aika","Muuttuja":"Virkistäytyvyys"},{"Luokka":"Menneisyys","Ryhma":"Arvostukset","Muuttuja":"Arvostus"},{"Luokka":"Menneisyys","Ryhma":"Arvostukset","Muuttuja":"Eettisyys"},{"Luokka":"Menneisyys","Ryhma":"Arvostukset","Muuttuja":"Esteettisyys"},{"Luokka":"Menneisyys","Ryhma":"Arvostukset","Muuttuja":"Kunnioitus"},{"Luokka":"Menneisyys","Ryhma":"Arvostukset","Muuttuja":"Puolustus"},{"Luokka":"Menneisyys","Ryhma":"Arvostukset","Muuttuja":"Rehellisyys"},{"Luokka":"Menneisyys","Ryhma":"Arvostukset","Muuttuja":"Saavutukset"},{"Luokka":"Menneisyys","Ryhma":"Arvostukset","Muuttuja":"Tasa-arvoisuus"},{"Luokka":"Menneisyys","Ryhma":"Arvostukset","Muuttuja":"Tasavertaisuus"},{"Luokka":"Menneisyys","Ryhma":"Arvostukset","Muuttuja":"Vapaus"},{"Luokka":"Menneisyys","Ryhma":"Kokemukset","Muuttuja":"Elämykset"},{"Luokka":"Menneisyys","Ryhma":"Kokemukset","Muuttuja":"Ensirakkaus"},{"Luokka":"Menneisyys","Ryhma":"Kokemukset","Muuttuja":"Koulukaverit"},{"Luokka":"Menneisyys","Ryhma":"Kokemukset","Muuttuja":"Muistot"},{"Luokka":"Menneisyys","Ryhma":"Kokemukset","Muuttuja":"Opettajat"},{"Luokka":"Menneisyys","Ryhma":"Kokemukset","Muuttuja":"Seksuaalisuus"},{"Luokka":"Menneisyys","Ryhma":"Kokemukset","Muuttuja":"Vastarakkaus"},{"Luokka":"Lähtökohdat","Ryhma":"Kulttuuri","Muuttuja":"Aatteellisuus"},{"Luokka":"Lähtökohdat","Ryhma":"Kulttuuri","Muuttuja":"Hyväksyvyys"},{"Luokka":"Lähtökohdat","Ryhma":"Kulttuuri","Muuttuja":"Ideologisuus"},{"Luokka":"Lähtökohdat","Ryhma":"Kulttuuri","Muuttuja":"Isänmaallisuus"},{"Luokka":"Lähtökohdat","Ryhma":"Kulttuuri","Muuttuja":"Kansallismielisyys"},{"Luokka":"Lähtökohdat","Ryhma":"Kulttuuri","Muuttuja":"Moraalisuus"},{"Luokka":"Lähtökohdat","Ryhma":"Kulttuuri","Muuttuja":"Oikeudenmukaisuus"},{"Luokka":"Lähtökohdat","Ryhma":"Kulttuuri","Muuttuja":"Omatunto"},{"Luokka":"Lähtökohdat","Ryhma":"Kulttuuri","Muuttuja":"Poliittisuus"},{"Luokka":"Lähtökohdat","Ryhma":"Kulttuuri","Muuttuja":"Sallivuus"},{"Luokka":"Lähtökohdat","Ryhma":"Perhe","Muuttuja":"Äiti"},{"Luokka":"Lähtökohdat","Ryhma":"Perhe","Muuttuja":"Isä"},{"Luokka":"Lähtökohdat","Ryhma":"Perhe","Muuttuja":"Läheisyys"},{"Luokka":"Lähtökohdat","Ryhma":"Perhe","Muuttuja":"Sisaruus"},{"Luokka":"Lähtökohdat","Ryhma":"Perhe","Muuttuja":"Väkivallattomuus"},{"Luokka":"Lähtökohdat","Ryhma":"Perhe","Muuttuja":"Vanhemmat"},{"Luokka":"Lähtökohdat","Ryhma":"Suku","Muuttuja":"Appivanhemmat"},{"Luokka":"Lähtökohdat","Ryhma":"Suku","Muuttuja":"Isovanhemmat"},{"Luokka":"Lähtökohdat","Ryhma":"Suku","Muuttuja":"Perinteellisyys"},{"Luokka":"Lähtökohdat","Ryhma":"Suku","Muuttuja":"Serkut"},{"Luokka":"Lähtökohdat","Ryhma":"Suku","Muuttuja":"Sovinnaisuus"},{"Luokka":"Lähtökohdat","Ryhma":"Suku","Muuttuja":"Sukulaisuus"},{"Luokka":"Lähtökohdat","Ryhma":"Suku","Muuttuja":"Vanhoillisuus"},{"Luokka":"Menneisyys","Ryhma":"Uskomukset","Muuttuja":"Anteeksiantavuus"},{"Luokka":"Menneisyys","Ryhma":"Uskomukset","Muuttuja":"Armollisuus"},{"Luokka":"Menneisyys","Ryhma":"Uskomukset","Muuttuja":"Elämänkatsomus"},{"Luokka":"Menneisyys","Ryhma":"Uskomukset","Muuttuja":"Hengellisyys"},{"Luokka":"Menneisyys","Ryhma":"Uskomukset","Muuttuja":"Henkisyys"},{"Luokka":"Menneisyys","Ryhma":"Uskomukset","Muuttuja":"Kohtalonomaisuus"},{"Luokka":"Menneisyys","Ryhma":"Uskomukset","Muuttuja":"Tieteellisyys"},{"Luokka":"Menneisyys","Ryhma":"Uskomukset","Muuttuja":"Uskonnollisuus"},{"Luokka":"Menneisyys","Ryhma":"Uskomukset","Muuttuja":"Vakaumus"},{"Luokka":"Menneisyys","Ryhma":"Uskomukset","Muuttuja":"Yliluonnollisuus"},{"Luokka":"Olosuhteet","Ryhma":"Hyvinvointi","Muuttuja":"Ikä"},{"Luokka":"Olosuhteet","Ryhma":"Hyvinvointi","Muuttuja":"Iloisuus"},{"Luokka":"Olosuhteet","Ryhma":"Hyvinvointi","Muuttuja":"Itsemyötätunto"},{"Luokka":"Olosuhteet","Ryhma":"Hyvinvointi","Muuttuja":"Kiitollisuus"},{"Luokka":"Olosuhteet","Ryhma":"Hyvinvointi","Muuttuja":"Luontosuhde"},{"Luokka":"Olosuhteet","Ryhma":"Hyvinvointi","Muuttuja":"Onnellisuus"},{"Luokka":"Olosuhteet","Ryhma":"Hyvinvointi","Muuttuja":"Tasapainoisuus"},{"Luokka":"Olosuhteet","Ryhma":"Hyvinvointi","Muuttuja":"Turvallisuus"},{"Luokka":"Olosuhteet","Ryhma":"Hyvinvointi","Muuttuja":"Tyytyväisyys"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Avoimuus"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Avunsaanti"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Empaattisuus"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Huumorintaju"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Kuunteleminen"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Läsnäolo"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Luottamus"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Vastaanottavuus"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Vastavuoroisuus"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Vuorovaikutus"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Ystävällisyys"},{"Luokka":"Nykyisyys","Ryhma":"Sosiaalisuus","Muuttuja":"Ystävyys"},{"Luokka":"Olosuhteet","Ryhma":"Terveys","Muuttuja":"Elämänhallinta"},{"Luokka":"Olosuhteet","Ryhma":"Terveys","Muuttuja":"Itsetunto"},{"Luokka":"Olosuhteet","Ryhma":"Terveys","Muuttuja":"Levollisuus"},{"Luokka":"Olosuhteet","Ryhma":"Terveys","Muuttuja":"Liikunnallisuus"},{"Luokka":"Olosuhteet","Ryhma":"Terveys","Muuttuja":"Mielenrauha"},{"Luokka":"Olosuhteet","Ryhma":"Terveys","Muuttuja":"Mielenterveys"},{"Luokka":"Olosuhteet","Ryhma":"Terveys","Muuttuja":"Raittius"},{"Luokka":"Olosuhteet","Ryhma":"Terveys","Muuttuja":"Rauhallisuus"},{"Luokka":"Olosuhteet","Ryhma":"Terveys","Muuttuja":"Stressinhallinta"},{"Luokka":"Olosuhteet","Ryhma":"Terveys","Muuttuja":"Terveellisyys"},{"Luokka":"Olosuhteet","Ryhma":"Toimintakyky","Muuttuja":"Aktiivisuus"},{"Luokka":"Olosuhteet","Ryhma":"Toimintakyky","Muuttuja":"Arjenhallinta"},{"Luokka":"Olosuhteet","Ryhma":"Toimintakyky","Muuttuja":"Energisyys"},{"Luokka":"Olosuhteet","Ryhma":"Toimintakyky","Muuttuja":"Esteettömyys"},{"Luokka":"Olosuhteet","Ryhma":"Toimintakyky","Muuttuja":"Jaksavuus"},{"Luokka":"Olosuhteet","Ryhma":"Toimintakyky","Muuttuja":"Kestävyys"},{"Luokka":"Olosuhteet","Ryhma":"Toimintakyky","Muuttuja":"Liikkuvuus"},{"Luokka":"Olosuhteet","Ryhma":"Toimintakyky","Muuttuja":"Omatoimisuus"},{"Luokka":"Nykyisyys","Ryhma":"Yhteisöllisyys","Muuttuja":"Osallistuvuus"},{"Luokka":"Nykyisyys","Ryhma":"Yhteisöllisyys","Muuttuja":"Tukiverkostot"},{"Luokka":"Nykyisyys","Ryhma":"Yhteisöllisyys","Muuttuja":"Vastuullisuus"},{"Luokka":"Nykyisyys","Ryhma":"Yhteisöllisyys","Muuttuja":"Verkostoituvuus"},{"Luokka":"Nykyisyys","Ryhma":"Yhteisöllisyys","Muuttuja":"Yhteenkuuluvuus"},{"Luokka":"Nykyisyys","Ryhma":"Yksilöllisyys","Muuttuja":"Avarakatseisuus"},{"Luokka":"Nykyisyys","Ryhma":"Yksilöllisyys","Muuttuja":"Itsearvostus"},{"Luokka":"Nykyisyys","Ryhma":"Yksilöllisyys","Muuttuja":"Itsehyväksyntä"},{"Luokka":"Nykyisyys","Ryhma":"Yksilöllisyys","Muuttuja":"Itseluottamus"},{"Luokka":"Nykyisyys","Ryhma":"Yksilöllisyys","Muuttuja":"Itsenäisyys"},{"Luokka":"Nykyisyys","Ryhma":"Yksilöllisyys","Muuttuja":"Itsetuntemus"},{"Luokka":"Nykyisyys","Ryhma":"Yksilöllisyys","Muuttuja":"Myönteisyys"},{"Luokka":"Nykyisyys","Ryhma":"Yksilöllisyys","Muuttuja":"Positiivisuus"},{"Luokka":"Nykyisyys","Ryhma":"Yksilöllisyys","Muuttuja":"Selviytyminen"},{"Luokka":"Nykyisyys","Ryhma":"Yksilöllisyys","Muuttuja":"Yksinolo"},{"Luokka":"Tulevaisuus","Ryhma":"Haaveet","Muuttuja":"Inspiraatio"},{"Luokka":"Tulevaisuus","Ryhma":"Haaveet","Muuttuja":"Intohimo"},{"Luokka":"Tulevaisuus","Ryhma":"Haaveet","Muuttuja":"Toiveikkuus"},{"Luokka":"Tulevaisuus","Ryhma":"Haaveet","Muuttuja":"Unelmoivuus"},{"Luokka":"Tulevaisuus","Ryhma":"Haaveet","Muuttuja":"Usko"},{"Luokka":"Tulevaisuus","Ryhma":"Haaveet","Muuttuja":"Visio"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Kasvu"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Menestyvyys"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Motivaatio"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Oma-aloitteisuus"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Oppimishalu"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Oppimiskyky"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Päätöksenteko"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Pystyvyys"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Selkeys"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Sisukkuus"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Taitavuus"},{"Luokka":"Voimavarat","Ryhma":"Kyvyt","Muuttuja":"Tarkkuus"},{"Luokka":"Tulevaisuus","Ryhma":"Mahdollisuudet","Muuttuja":"Aloitteellisuus"},{"Luokka":"Tulevaisuus","Ryhma":"Mahdollisuudet","Muuttuja":"Innostuvuus"},{"Luokka":"Tulevaisuus","Ryhma":"Mahdollisuudet","Muuttuja":"Innovatiivisuus"},{"Luokka":"Tulevaisuus","Ryhma":"Mahdollisuudet","Muuttuja":"Intuitio"},{"Luokka":"Tulevaisuus","Ryhma":"Mahdollisuudet","Muuttuja":"Itsevarmuus"},{"Luokka":"Tulevaisuus","Ryhma":"Mahdollisuudet","Muuttuja":"Luovuus"},{"Luokka":"Tulevaisuus","Ryhma":"Mahdollisuudet","Muuttuja":"Merkitys"},{"Luokka":"Tulevaisuus","Ryhma":"Mahdollisuudet","Muuttuja":"Oivaltavuus"},{"Luokka":"Tulevaisuus","Ryhma":"Mahdollisuudet","Muuttuja":"Riskinotto"},{"Luokka":"Tulevaisuus","Ryhma":"Mahdollisuudet","Muuttuja":"Rohkeus"},{"Luokka":"Voimavarat","Ryhma":"Taidot","Muuttuja":"Huolellisuus"},{"Luokka":"Voimavarat","Ryhma":"Taidot","Muuttuja":"Itsehillintä"},{"Luokka":"Voimavarat","Ryhma":"Taidot","Muuttuja":"Itseohjautuvuus"},{"Luokka":"Voimavarat","Ryhma":"Taidot","Muuttuja":"Joustavuus"},{"Luokka":"Voimavarat","Ryhma":"Taidot","Muuttuja":"Kehittyvyys"},{"Luokka":"Voimavarat","Ryhma":"Taidot","Muuttuja":"Koulutus"},{"Luokka":"Voimavarat","Ryhma":"Taidot","Muuttuja":"Sopeutuvuus"},{"Luokka":"Voimavarat","Ryhma":"Taidot","Muuttuja":"Uppoutuminen"},{"Luokka":"Voimavarat","Ryhma":"Taidot","Muuttuja":"Uteliaisuus"},{"Luokka":"Tulevaisuus","Ryhma":"Tavoitteet","Muuttuja":"Haasteellisuus"},{"Luokka":"Tulevaisuus","Ryhma":"Tavoitteet","Muuttuja":"Kärsivällisyys"},{"Luokka":"Tulevaisuus","Ryhma":"Tavoitteet","Muuttuja":"Päämäärätietoisuus"},{"Luokka":"Tulevaisuus","Ryhma":"Tavoitteet","Muuttuja":"Pitkäjännitteisyys"},{"Luokka":"Tulevaisuus","Ryhma":"Tavoitteet","Muuttuja":"Realistisuus"},{"Luokka":"Tulevaisuus","Ryhma":"Tavoitteet","Muuttuja":"Saavutettavuus"},{"Luokka":"Tulevaisuus","Ryhma":"Tavoitteet","Muuttuja":"Sitkeys"},{"Luokka":"Tulevaisuus","Ryhma":"Tavoitteet","Muuttuja":"Tahto"},{"Luokka":"Tulevaisuus","Ryhma":"Tavoitteet","Muuttuja":"Tarkoitus"},{"Luokka":"Tulevaisuus","Ryhma":"Tavoitteet","Muuttuja":"Tavoitteellisuus"},{"Luokka":"Voimavarat","Ryhma":"Tiedot","Muuttuja":"Älykkyys"},{"Luokka":"Voimavarat","Ryhma":"Tiedot","Muuttuja":"Analyyttisyys"},{"Luokka":"Voimavarat","Ryhma":"Tiedot","Muuttuja":"Harkitsevuus"},{"Luokka":"Voimavarat","Ryhma":"Tiedot","Muuttuja":"Kriittisyys"},{"Luokka":"Voimavarat","Ryhma":"Tiedot","Muuttuja":"Loogisuus"},{"Luokka":"Voimavarat","Ryhma":"Tiedot","Muuttuja":"Omaksuvuus"},{"Luokka":"Voimavarat","Ryhma":"Tiedot","Muuttuja":"Päättelykyky"},{"Luokka":"Voimavarat","Ryhma":"Tiedot","Muuttuja":"Rationaalisuus"},{"Luokka":"Voimavarat","Ryhma":"Tiedot","Muuttuja":"Viisaus"},{"Luokka":"Voimavarat","Ryhma":"Tiedot","Muuttuja":"Ymmärrys"}
    ];

      var length = d3.scaleLinear().domain([0, 100]).range([r, width / 2 - margin["top"]]);
      var rotationDegree = d3.scalePoint().domain(Object.keys(vars)).range([0, 2 * Math.PI - Math.PI / 6]);
      var rotationDegree1 = d3.scalePoint().domain(Object.keys(mars)).range([0, 2 * Math.PI - Math.PI / 6]);
      var colorScale = d3.scaleOrdinal().domain([0, 1, 2]).range(["#5cb470", "#ff0025", "#f21488"]);
      var colorScale0 = d3.scaleOrdinal().domain([0, 1, 2]).range(["#5cb470", "#ff0025", "#f21488"]);
      var colorScale1 = d3.scaleOrdinal().domain([0, 1, 2]).range(["#ff0025", "#5cb470", "#f21488"]);

      var legendData = [
      { country_name: "Tulevaisuus", name: "Tavoitteet", metric: "yksilollisyys", percentile: 0, top_country: "0" },
      { country_name: "Tulevaisuus", name: "Haaveet", metric: "sosiaalisuus", percentile: 0, top_country: "0" },
      { country_name: "Tulevaisuus", name: "Mahdollisuudet", metric: "yhteisollisyys", percentile: 0, top_country: "0" },
      { country_name: "Ajanhallinta", name: "Tärkeys", metric: "tavoitteet", percentile: 0, top_country: "0" },
      { country_name: "Ajanhallinta", name: "Järjestys", metric: "haaveet", percentile: 0, top_country: "0" },
      { country_name: "Ajanhallinta", name: "Ajoitus", metric: "mahdollisuudet", percentile: 0, top_country: "0" },
      { country_name: "Menneisyys", name: "Arvostukset", metric: "tarkeys", percentile: 0, top_country: "0" },
      { country_name: "Menneisyys", name: "Uskomukset", metric: "jarjestys", percentile: 0, top_country: "0" },
      { country_name: "Menneisyys", name: "Kokemukset", metric: "ajoitus", percentile: 0, top_country: "0" },
      { country_name: "Nykyisyys", name: "Yksilöllisyys", metric: "arvostukset", percentile: 0, top_country: "0" },
      { country_name: "Nykyisyys", name: "Sosiaalisuus", metric: "uskomukset", percentile: 0, top_country: "0" },
      { country_name: "Nykyisyys", name: "Yhteisöllisyys", metric: "kokemukset", percentile: 0, top_country: "0" }
      ];
      
      var legendData1 = [
      { country_name: "Voimavarat", name: "Taidot", metric: "terveys", percentile: 0, top_country: "0" },
      { country_name: "Voimavarat", name: "Tiedot", metric: "hyvinvointi", percentile: 0, top_country: "0" },
      { country_name: "Voimavarat", name: "Kyvyt", metric: "toimintakyky", percentile: 0, top_country: "0" },
      { country_name: "Ympäristö", name: "Työ", metric: "taidot", percentile: 0, top_country: "0" },
      { country_name: "Ympäristö", name: "Koti", metric: "tiedot", percentile: 0, top_country: "0" },
      { country_name: "Ympäristö", name: "Vapaa-aika", metric: "kyvyt", percentile: 0, top_country: "0" },
      { country_name: "Lähtökohdat", name: "Kulttuuri", metric: "tyo", percentile: 0, top_country: "0" },
      { country_name: "Lähtökohdat", name: "Suku", metric: "koti", percentile: 0, top_country: "0" },
      { country_name: "Lähtökohdat", name: "Perhe", metric: "vapaa", percentile: 0, top_country: "0" },
      { country_name: "Olosuhteet", name: "Terveys", metric: "kulttuuri", percentile: 0, top_country: "0" },
      { country_name: "Olosuhteet", name: "Hyvinvointi", metric: "suku", percentile: 0, top_country: "0" },
      { country_name: "Olosuhteet", name: "Toimintakyky", metric: "perhe", percentile: 0, top_country: "0" }
      ];
      
    var sdata = [
        { "label": "Menneisyys", "value": 0 },
        { "label": "Nykyisyys", "value": 0 },
        { "label": "Tulevaisuus", "value": 0 },
        { "label": "Ajanhallinta", "value": 0 }
    ];
    
    var sdata1 = [
        { "label": "Lähtökohdat", "value": 0 },
        { "label": "Olosuhteet", "value": 0 },
        { "label": "Voimavarat", "value": 0 },
        { "label": "Ympäristö", "value": 0 }
    ];
    
    
d3.selectAll("#sun_legend > *").remove();
d3.selectAll("#sun_legend1 > *").remove();
d3.selectAll("#legend_list > *").remove();
d3.selectAll("#legend_list1 > *").remove();
d3.selectAll("#suns > *").remove();
d3.selectAll("#suns1 > *").remove();
d3.selectAll("#chart > *").remove();
d3.selectAll("#chart1 > *").remove();
d3.selectAll("#legend > *").remove();
d3.selectAll("#legend1 > *").remove();

var summa = d3.sum(tiedot, function(d) { return 1; });

    tiedot.forEach(function(datum) {
      zdata.forEach(function(data) {
        if (datum.text === data.Muuttuja && datum.color === vari) {
          datum.text = data.Muuttuja;
          //datum.color = "red"; 
          
          legendData.forEach(function(legend) {
            if (legend.name === data.Ryhma) {
              legend.percentile += 1; 
            }
          });
          
          legendData1.forEach(function(legend1) {
            if (legend1.name === data.Ryhma) {
              legend1.percentile += 1; 
            }
          });
                    
          sdata.forEach(function(legend2) {
            if (legend2.label === data.Luokka) {
              legend2.value += 1; 
            }
          }); 

          sdata1.forEach(function(legend3) {
            if (legend3.label === data.Luokka) {
                        console.log(legend3.label); 
              legend3.value += 1; 
            }
          }); 
          
          
          
        }
      });
    });

    console.log(tiedot);
    console.log(legendData);
    console.log(legendData1);
    console.log(sdata);
    console.log(sdata1); 
    
var summa1 = d3.sum(sdata, function(d) { return d.value; }); 
var summa2 = d3.sum(sdata1, function(d) { return d.value; }); 

    // Päivitetään "legendData" taulukon prosenttiosuudet
    legendData.forEach(function(d) {
      d.percentile = (d.percentile / summa) * 2000;
    });
    
    legendData1.forEach(function(d) {
      d.percentile = (d.percentile / summa) * 2000;
    });

    sdata.forEach(function(d) {
      d.value = (d.value / summa1) * 100;        
    }); 

    sdata1.forEach(function(d) {
      d.value = (d.value / summa2) * 100;            
    });
      data = xdata;
      data1 = ydata;
        data.sort(function(x, y) { return d3.ascending(x.country_name, y.country_name); });
        var nested_data = d3.nest().key(function(d) { return d.country_name; }).entries(data.filter(function(d) { return !isNaN(d.percentile); }));
        
        data1.sort(function(x, y) { return d3.ascending(x.country_name, y.country_name); });
        var nested_data1 = d3.nest().key(function(d) { return d.country_name; }).entries(data1.filter(function(d) { return !isNaN(d.percentile); }));

      function drawLegend(data) {
if(yhteen === "green")
colorScale = colorScale0

if(yhteen === "red")
colorScale = colorScale1
 
        var svg = d3.select("#sun_legend")
          .attr("width", 200)
          .attr("height", 200)
          .append("g");

        svg.selectAll(".ray")
        .data(legendData)
        .enter()
        .append("line")
        .attr("class", "sun ray")
        .attr("x1", 100)
        .attr("y1", 100)
        .attr("x2", function(d) {
          return length(d.percentile) * Math.cos(rotationDegree(d.metric)) + 100;
        })
        .attr("y2", function(d) {
          return length(d.percentile) * Math.sin(rotationDegree(d.metric)) + 100;
        })
        .style("stroke", function(d) {
          return colorScale(d.top_country);
        });
        
        svg.selectAll(".legendText")
          .data(legendData)
          .enter()
          .append("text")
          .attr("class", "legendText")
          .attr("x", function(d, i) { return (i >= 5 && i <= 9) ? 95 * Math.cos(rotationDegree(d.metric) - Math.PI/2) + 100 : 93 * Math.cos(rotationDegree(d.metric) - Math.PI/2) + 100; })
          .attr("y", function(d, i) { return (i >= 5 && i <= 9) ? 95 * Math.sin(rotationDegree(d.metric) - Math.PI/2) + 100 : 93 * Math.sin(rotationDegree(d.metric) - Math.PI/2) + 100; })
          .text(function(d, i) { return i + 1; });

var legendList = d3.select("#legend_list")
    .append("ul")
    .attr("class", "legendList");

  svg.selectAll(".legendText")
    .data(data)
    .enter()
    .append("text")
    .attr("class", "legendText")
    .attr("x", function(d, i) {
      return (i >= 5 && i <= 9) ? rayLength * Math.cos(rotationDegree(d.metric) - Math.PI/2) + 100 + textOffset : rayLength * Math.cos(rotationDegree(d.metric) - Math.PI/2) + 100 - textOffset;
    })
    .attr("y", function(d, i) {
      return rayLength * Math.sin(rotationDegree(d.metric) - Math.PI/2) + 100;
    })
    .text(function(d, i) { return i + 1 + "-" +vars[d.metric]; });

  // Lisää tekstit luetteloon
  legendList.selectAll("li")
    .data(data)
    .enter()
    .append("li")
    .text(function(d, i) { return i + 1 + "-" +vars[d.metric]; });

        svg.append("circle")
          .attr("class", "sun center")
          .attr("cx", 100)
          .attr("cy", 100)
          .attr("r", 20)
          .style("stroke", "#fff");

        // add "grid" lines
        svg.append("circle")
          .attr("class", "sun gridline")
          .attr("cx", 100)
          .attr("cy", 100)
          .attr("r", 35);

        svg.append("circle")
          .attr("class", "sun gridline")
          .attr("cx", 100)
          .attr("cy", 100)
          .attr("r", 50);

        svg.append("circle")
          .attr("class", "sun gridline")
          .attr("cx", 100)
          .attr("cy", 100)
          .attr("r", 65);
      }
      
      function drawLegend1(legendData1) {
if(yhteen === "green")
colorScale = colorScale0

if(yhteen === "red")
colorScale = colorScale1

        var svg = d3.select("#sun_legend1")
          .attr("width", 200)
          .attr("height", 200)
          .append("g");

        svg.selectAll(".ray")
        .data(legendData1)
        .enter()
        .append("line")
        .attr("class", "sun ray")
        .attr("x1", 100)
        .attr("y1", 100)
        .attr("x2", function(d) {
          return length(d.percentile) * Math.cos(rotationDegree1(d.metric)) + 100;
        })
        .attr("y2", function(d) {
          return length(d.percentile) * Math.sin(rotationDegree1(d.metric)) + 100;
        })
        .style("stroke", function(d) {
          return colorScale(d.top_country);
        });        

        svg.selectAll(".legendText")
          .data(legendData1)
          .enter()
          .append("text")
          .attr("class", "legendText")
          .attr("x", function(d, i) { return (i >= 5 && i <= 9) ? 95 * Math.cos(rotationDegree1(d.metric) - Math.PI/2) + 100 : 93 * Math.cos(rotationDegree1(d.metric) - Math.PI/2) + 100; })
          .attr("y", function(d, i) { return (i >= 5 && i <= 9) ? 95 * Math.sin(rotationDegree1(d.metric) - Math.PI/2) + 100 : 93 * Math.sin(rotationDegree1(d.metric) - Math.PI/2) + 100; })
          .text(function(d, i) { return i + 1; });      
      
var legendList1 = d3.select("#legend_list1")
    .append("ul")
    .attr("class", "legendList");

  svg.selectAll(".legendText")
    .data(legendData1)
    .enter()
    .append("text")
    .attr("class", "legendText")
    .attr("x", function(d, i) {
      return (i >= 5 && i <= 9) ? rayLength * Math.cos(rotationDegree(d.metric) - Math.PI/2) + 100 + textOffset : rayLength * Math.cos(rotationDegree(d.metric) - Math.PI/2) + 100 - textOffset;
    })
    .attr("y", function(d, i) {
      return rayLength * Math.sin(rotationDegree(d.metric) - Math.PI/2) + 100;
    })
    .text(function(d, i) { return i + 1 + "-" +mars[d.metric]; });

  // Lisää tekstit luetteloon
  legendList1.selectAll("li")
    .data(legendData1)
    .enter()
    .append("li")
    .text(function(d, i) { return i + 1 + "-" +mars[d.metric]; });

        svg.append("circle")
          .attr("class", "sun center")
          .attr("cx", 100)
          .attr("cy", 100)
          .attr("r", 20)
          .style("stroke", "#fff");

        // add "grid" lines
        svg.append("circle")
          .attr("class", "sun gridline")
          .attr("cx", 100)
          .attr("cy", 100)
          .attr("r", 35);

        svg.append("circle")
          .attr("class", "sun gridline")
          .attr("cx", 100)
          .attr("cy", 100)
          .attr("r", 50);

        svg.append("circle")
          .attr("class", "sun gridline")
          .attr("cx", 100)
          .attr("cy", 100)
          .attr("r", 65);
      }
      
      
function waffle(section){
    // Määritä waffle-kuvion koko ja marginaalit
    var waffleWidth = 250;
    var waffleHeight = 250;
    var margin = { top: 30, right: 120, bottom: 30, left: 0 };
    var width = waffleWidth - margin.left - margin.right;
    var height = waffleHeight - margin.top - margin.bottom;

var xOffset = 0;
var yOffset = -100;

    
// Luo svg-elementti waffle-kuvion piirtämistä varten
//var svg = d3.select("svg")
var svg = d3.select("#chart").append("svg")
    .attr("width", waffleWidth) // Pysyvä leveys
    .attr("height", waffleHeight) // Pysyvä korkeus
    .append("g")
    .attr("transform", "translate(" + (waffleWidth / 2 + xOffset) + "," + (waffleHeight / 2 + yOffset) + ") rotate(45)");
    
var svg1 = d3.select("#chart1").append("svg")
    .attr("width", waffleWidth) // Pysyvä leveys
    .attr("height", waffleHeight) // Pysyvä korkeus
    .append("g")
    .attr("transform", "translate(" + (waffleWidth / 2 + xOffset) + "," + (waffleHeight / 2 + yOffset) + ") rotate(45)"); 

    
    var cellsPerRow = 10;
    var numRows = Math.ceil(d3.sum(sdata, function (d) { return d.value; }) / cellsPerRow);
    var cellSize = Math.sqrt((width * height) / (cellsPerRow * numRows));

    var cellData = [];
    sdata.forEach(function (d) {
        for (var i = 0; i < d.value; i++) {
            cellData.push({ label: d.label });
        }
    });
    
    var cellData1 = [];
    sdata1.forEach(function (d) {
        for (var i = 0; i < d.value; i++) {
            cellData1.push({ label: d.label });
        }
    });

var kumpi = 2;
if(kumpi === 1) {

var cells = svg.selectAll(".cell")
        .data(cellData)
        .enter() 
        .append("rect")
        .attr("class", function (d) { return "cell " + d.label; })
        .attr("x", function (d, i) {
            var col = i % cellsPerRow;
            return col * cellSize;
        })
        .attr("y", function (d, i) {
            var row = Math.floor(i / cellsPerRow);
            return row * cellSize;
        })
        cells.attr("width", cellSize-2)
        cells.attr("height", cellSize-2);


        
        
var legend = d3.select("#legend")
        .append("div")
        .attr("class", "legend");

    sdata.forEach(function (d) {
        var legendItem = legend.append("div")
            .attr("class", "legend_item");

        legendItem.append("div")
            .attr("class", "legend_item_icon")
            .style("background-color", function () {
                return d.label === "Menneisyys" ? "#CE2A23" : d.label === "Nykyisyys" ? "#555" : d.label === "Tulevaisuus" ? "#aaa" : "#ccc";
            });

        legendItem.append("div")
            .text(d.label + " " + d.value.toFixed(1) + " %");
    });        
        
        
//*******
var cells1 = svg1.selectAll(".cell")
        .data(cellData1)
        .enter()
        .append("rect")
        .attr("class", function (d) { return "cell " + d.label; })
        .attr("x", function (d, i) {
            var col = i % cellsPerRow;
            return col * cellSize;
        })
        .attr("y", function (d, i) {
            var row = Math.floor(i / cellsPerRow);
            return row * cellSize;
        })
        cells1.attr("width", cellSize-2)
        cells1.attr("height", cellSize-2);

        
var legend1 = d3.select("#legend1")
        .append("div")
        .attr("class", "legend");

    sdata1.forEach(function (d) {
        var legendItem1 = legend1.append("div")
            .attr("class", "legend_item");

        legendItem1.append("div")
            .attr("class", "legend_item_icon")
            .style("background-color", function () {
                return d.label === "Lähtökohdat" ? "#CE2A23" : d.label === "Olosuhteet" ? "#555" : d.label === "Voimavarat" ? "#aaa" : "#ccc";
            });

        legendItem1.append("div")
            .text(d.label + " " + d.value.toFixed(1) + " %");
    });        
        
               
} else {        
var circles = svg.selectAll(".cell")
    .data(cellData)
    .enter()
    .append("circle")
    .attr("class", function (d) { return "cell " + d.label; })
    .attr("cx", function (d, i) {
        var col = i % cellsPerRow;
        return col * cellSize ; 
    })
    .attr("cy", function (d, i) {
        var row = Math.floor(i / cellsPerRow);
        return row * cellSize ; 
    }) 
    .attr("r", cellSize / 2.4); 


var legend = d3.select("#legend")
        .append("div")
        .attr("class", "legend");

    sdata.forEach(function (d) {
        var legendItem = legend.append("div")
            .attr("class", "legend_item");

        legendItem.append("div")
            .attr("class", "legend_item_icon")
            .style("border-radius", "50%")
            .style("background-color", function () {
                return d.label === "Menneisyys" ? "#CE2A23" : d.label === "Nykyisyys" ? "#555" : d.label === "Tulevaisuus" ? "#aaa" : "#ccc";
            });

        legendItem.append("div")
            .text(d.label + " " + d.value.toFixed(1) + " %");
    });


var circles1 = svg1.selectAll(".cell")
    .data(cellData1)
    .enter()
    .append("circle")
    .attr("class", function (d) { return "cell " + d.label; })
    .attr("cx", function (d, i) {
        var col = i % cellsPerRow;
        return col * cellSize ; 
    })
    .attr("cy", function (d, i) {
        var row = Math.floor(i / cellsPerRow);
        return row * cellSize ; 
    }) 
    .attr("r", cellSize / 2.4); 


var legend1 = d3.select("#legend1")
        .append("div")
        .attr("class", "legend");

    sdata1.forEach(function (d) {
        var legendItem1 = legend1.append("div")
            .attr("class", "legend_item");

        legendItem1.append("div")
            .attr("class", "legend_item_icon")
            .style("border-radius", "50%")
            .style("background-color", function () {
                return d.label === "Lähtökohdat" ? "#CE2A23" : d.label === "Olosuhteet" ? "#555" : d.label === "Voimavarat" ? "#aaa" : "#ccc";
            });

        legendItem1.append("div")
            .text(d.label + " " + d.value.toFixed(1) + " %");
    });
}

}




        drawLegend(legendData);
        drawLegend1(legendData1);
        waffle(1);
        //makeSuns(nested_data);
        //makeSuns1(nested_data1);
        
      
    })();
			
}



document.getElementById("message").value = alkuinfo;		
	svg.on("dblclick", handleDoubleClick);
	</script>
</body>
</html>
